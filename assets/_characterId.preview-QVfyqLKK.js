import{j as t,u as Fe,C as B,aj as Ca,ak as ya,al as wa,S as yt,p as wt,q as kt,ad as qn,am as ka,c as D,s as Nt,a0 as Ke,a1 as _e,a2 as Jt,a4 as Qt,an as St,a5 as Dt,r as d,t as me,G as fe,V as Na,F as Sa,D as Xe,ao as je,ap as Da,aq as Ce,ar as ye,as as we,at as ke,au as Nn,av as Ne,x as Ve,aw as Ra,H as Ea,v as Ta,w as Aa,ax as Fa,ay as Ma,az as Oa,aA as Hn,X as Ba,aB as Ia,aC as La,aD as za,aE as $a,R as M,aF as Pe,aG as Pa,aH as Va,aI as Ga,aJ as qa,aK as Ha,aL as Ka,aM as _a,aN as Xa,aO as Ya,n as Ua,L as Wa,o as Ja,B as Qa}from"./index-BNfkjerg.js";import{C as gt,k as Xt,a as z,D as Za,H as er,S as Rt,b as Et,d as Tt,e as At,f as X,g as tr,h as nr,i as ut,j as ht,l as Sn,n as Dn,o as ar,T as be}from"./tabs-PA6923pC.js";import{d as re,P as Qe,a as Ze,b as et,T as Kn,M as rr,B as sr,S as or}from"./popover-DoWH-WNk.js";import{u as Me,a as T,b as A,c as F,L as Rn,F as tt}from"./useForm-BPETwcHA.js";import"./item-B4Tk1eFb.js";import"./chevron-down-D808b4Qj.js";import"./trash-2-DpLeFAIS.js";function Ye({maxTrack:e,track:n,onChange:r}){const s=(o,a)=>{r(a?o+1:o)};return t.jsx("div",{className:"flex gap-2",children:Array.from({length:e},(o,a)=>t.jsx(gt,{checked:a<n,onCheckedChange:i=>s(a,i===!0)},a))})}function Ft(){const{resolveRefrence:e}=Fe(),{resolveReference:n}=B();return{resolveReference:(s,o)=>{if(Ca.safeParse(s).success)return e(s,o);if(ya.safeParse(s).success){const l={aspects:"customAspects",oddements:"customOddements",fragments:"customFragments",campingGear:"customCampingGear",tags:"customTags"}[o];return n(s,l)}return console.error(`Invalid reference: ${s}`),null}}}const nt=wa(e=>({open:!1,type:null,openDialog:n=>e({open:!0,type:n}),closeDialog:()=>e({open:!1})}));function ir({aspects:e,className:n=""}){const{openDialog:r}=nt();return t.jsxs(yt,{className:n,children:[t.jsxs(wt,{children:[t.jsx(kt,{children:t.jsx("h2",{children:"Aspects"})}),t.jsx(qn,{children:"(Add 1d6 if appropriate)"}),t.jsx(ka,{children:t.jsx(D,{size:"icon-sm",className:"mr-4",onClick:()=>r("aspect"),children:t.jsx(re,{})})})]}),t.jsx(Nt,{className:`grid gap-4 ${n}`,children:e.map((s,o)=>t.jsx(cr,{aspect:s,aspectIndex:o},o))})]})}function cr({aspect:e,aspectIndex:n}){const{resolveReference:r}=Ft(),{updateCharacter:s,character:o}=B(),a=r(e.ref,"aspects");function i(l){if(!o?.data?.aspects)return;const u=[...o.data.aspects];u[n]={...u[n],track:l},s({data:{...o.data,aspects:u}})}function c(){const l=o.data.aspects.filter((u,h)=>h!==n);l&&s({data:{...o.data,aspects:l}})}return a?t.jsxs(Ke,{className:"sprite-border gap-2 pb-2",children:[t.jsxs(_e,{children:[t.jsx(Jt,{children:a.name}),t.jsxs(Qt,{className:"flex items-center gap-2",children:[t.jsx("span",{children:a.category}),t.jsx(D,{variant:"destructive",size:"icon-sm",onClick:c,children:t.jsx(St,{})})]})]}),t.jsxs(Dt,{className:"flex flex-col gap-2",children:[t.jsx(Ye,{maxTrack:a.maxTrack,track:e.track,onChange:i}),t.jsxs("span",{children:["Effect: ",a.effect]})]})]}):t.jsx(Ke,{children:t.jsx(_e,{children:"Aspect not found"})})}function lr(){const{isSaving:e}=B(),n=d.useRef(!1);return d.useEffect(()=>{e&&!n.current?n.current=!0:!e&&n.current&&(n.current=!1,me.success("Character saved"))},[e]),null}const dr=Na("flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",{variants:{orientation:{horizontal:"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",vertical:"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none"}},defaultVariants:{orientation:"horizontal"}});function ur({className:e,orientation:n,...r}){return t.jsx("div",{role:"group","data-slot":"button-group","data-orientation":n,className:fe(dr({orientation:n}),e),...r})}function hr({className:e,asChild:n=!1,...r}){const s=n?Sa:"div";return t.jsx(s,{className:fe("bg-muted flex items-center gap-2 rounded-md border px-4 text-sm font-medium shadow-xs [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",e),...r})}function Zt({quantity:e,setQuantity:n}){return t.jsxs(ur,{children:[t.jsx(D,{size:"icon-sm",onClick:()=>n(e-1),disabled:e<=1,children:t.jsx(rr,{})}),t.jsx(hr,{className:"bg-primary border-none max-w-10 px-0 flex items-center justify-center",children:t.jsx(z,{className:"h-auto text-primary-foreground max-w-10 text-center",value:e,onChange:r=>{const s=r.target.value;if(s===""){n(0);return}const o=Number(s);isNaN(o)||n(Math.max(1,o))}})}),t.jsx(D,{size:"icon-sm",onClick:()=>n(e+1),children:t.jsx(re,{})})]})}function mr({reference:e,index:n}){const{resolveReference:r}=Ft(),{character:s,updateCharacter:o}=B(),a=r(e.ref,"oddements");if(!a)return t.jsx("p",{children:"Oddement Not Found"});const[i,c]=d.useState(e.quantity);function l(h){const m=[...s.data.backpack.oddements],f=m[n];if(!f)return;const x=(f.tags??[]).filter(C=>C!==h);m[n]={...f,tags:x},o({data:{...s.data,backpack:{...s.data.backpack,oddements:m}}})}d.useEffect(()=>{const h=s.data.backpack.oddements.findIndex(f=>f.ref===e.ref&&Xt(f.tags,e.tags));if(h===-1)return;const m=[...s.data.backpack.oddements];m[h]={...m[h],quantity:i},o({data:{...s.data,backpack:{...s.data.backpack,oddements:m}}})},[i]);function u(){const h=s.data.backpack.oddements.filter(m=>!(m.ref===e.ref&&Xt(m.tags,e.tags)));o({data:{...s.data,backpack:{...s.data.backpack,oddements:h}}})}return t.jsxs(Qe,{children:[t.jsx(Ze,{asChild:!0,children:t.jsxs("div",{className:"text-sm capitalize cursor-help",children:[t.jsxs("span",{className:`font-semibold inline-block text-right ${e.quantity<10?"min-w-[2ch]":"min-w-[3ch]"}`,children:[e.quantity,"x"]})," ",t.jsx("span",{className:"italic",children:a.name})]})}),t.jsxs(et,{children:[t.jsx("header",{children:t.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.tags&&e.tags.length>0&&t.jsx(t.Fragment,{children:e.tags.map(h=>{const m=r(h,"tags");return m?t.jsx(Kn,{tag:m,onRemove:()=>l(h)},m.id):t.jsx(Xe,{children:"Tag not Found"},h)})}),t.jsx(pr,{itemIndex:n,children:t.jsx(Xe,{className:"w-5.5 aspect-square p-0 cursor-pointer",children:t.jsx(re,{})})})]})}),t.jsx("div",{className:"mt-2",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-1",children:a.description}),a.image&&t.jsx("div",{className:"shrink-0 flex items-end",children:t.jsx("img",{src:`data:image/png;base64,${a.image}`,alt:a.name,className:"h-16 w-auto object-contain rounded-md"})})]})}),t.jsxs("footer",{className:"flex justify-between items-center",children:[t.jsx(Zt,{quantity:i,setQuantity:c}),t.jsx(D,{size:"icon-sm",onClick:u,children:t.jsx(St,{})})]})]})]})}function fr({reference:e}){const{resolveReference:n}=Ft(),{character:r,updateCharacter:s}=B(),o=n(e.ref,"fragments");if(!o)return t.jsx("p",{children:"Fragment Not Found"});const[a,i]=d.useState(e.quantity);d.useEffect(()=>{const l=r.data.backpack.fragments.findIndex(h=>h.ref===e.ref);if(l===-1)return;const u=[...r.data.backpack.fragments];u[l]={...u[l],quantity:a},s({data:{...r.data,backpack:{...r.data.backpack,fragments:u}}})},[a]);function c(){const l=r.data.backpack.fragments.filter(u=>u.ref!==e.ref);s({data:{...r.data,backpack:{...r.data.backpack,fragments:l}}})}return t.jsxs(Qe,{children:[t.jsx(Ze,{asChild:!0,children:t.jsxs("div",{className:"text-sm capitalize cursor-help",children:[t.jsxs("span",{className:`font-semibold inline-block text-right ${e.quantity<10?"min-w-[2ch]":"min-w-[3ch]"}`,children:[e.quantity,"x"]})," ",t.jsx("span",{className:"italic",children:o.name})]})}),t.jsxs(et,{children:[t.jsx("header",{children:t.jsx(Xe,{children:o.type})}),t.jsx("div",{className:"mt-2",children:o.description}),t.jsxs("footer",{className:"flex justify-between items-center",children:[t.jsx(Zt,{quantity:a,setQuantity:i}),t.jsx(D,{size:"icon-sm",onClick:c,children:t.jsx(St,{})})]})]})]})}function gr({reference:e}){const{resolveReference:n}=Ft(),{character:r,updateCharacter:s}=B(),o=n(e.ref,"campingGear");if(!o)return t.jsx("p",{children:"Camping Gear Not Found"});const[a,i]=d.useState(e.quantity);d.useEffect(()=>{const l=r.data.backpack.campingGear.findIndex(h=>h.ref===e.ref);if(l===-1)return;const u=[...r.data.backpack.campingGear];u[l]={...u[l],quantity:a},s({data:{...r.data,backpack:{...r.data.backpack,campingGear:u}}})},[a]);function c(){const l=r.data.backpack.campingGear.filter(u=>u.ref!==e.ref);s({data:{...r.data,backpack:{...r.data.backpack,campingGear:l}}})}return t.jsxs(Qe,{children:[t.jsx(Ze,{asChild:!0,children:t.jsxs("div",{className:"text-sm capitalize cursor-help",children:[t.jsxs("span",{className:`font-semibold inline-block text-right ${e.quantity<10?"min-w-[2ch]":"min-w-[3ch]"}`,children:[e.quantity,"x"]})," ",t.jsx("span",{className:"italic",children:o.name})]})}),t.jsxs(et,{children:[t.jsx("header",{children:t.jsx(Xe,{children:o.stakes?"Stakes: "+o.stakes:"Free"})}),t.jsx("div",{className:"mt-2",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-md",children:o.description}),t.jsxs("div",{className:"mt-2 italic text-sm",children:[t.jsx("strong",{children:"Effect:"})," ",o.effect]})]}),o.image&&t.jsx("div",{className:"shrink-0 flex items-end",children:t.jsx("img",{src:`data:image/png;base64,${o.image}`,alt:o.name,className:"h-16 w-auto object-contain rounded-md"})})]})}),t.jsxs("footer",{className:"flex justify-between items-center",children:[t.jsx(Zt,{quantity:a,setQuantity:i}),t.jsx(D,{size:"icon-sm",onClick:c,children:t.jsx(St,{})})]})]})]})}function pr({itemIndex:e,children:n}){const{getAllSourcesDataArray:r}=Fe(),{character:s,updateCharacter:o,getCharacterDataArray:a}=B(),i=r("tags")??[],c=a("customTags")??[],l=[...i,...c],[u,h]=d.useState(""),{openDialog:m}=nt(),f=d.useMemo(()=>{const C=s.data.backpack.oddements[e],v=new Set(C?.tags??[]);return l.filter(b=>!v.has(b.id)).filter(b=>{if(!u)return!0;const j=u.toLowerCase();return b.name.toLowerCase().includes(j)||(b.description??"").toLowerCase().includes(j)})},[l,s.data.backpack,e,u]);function x(C){const v=s.data.backpack.oddements[e];if(!v)return;const b={...v,tags:[...v.tags||[],C]},j=[...s.data.backpack.oddements];j[e]=b,o({data:{...s.data,backpack:{...s.data.backpack,oddements:j}}})}return t.jsxs(je,{children:[t.jsx(Da,{className:"w-5 h-5 p-0 m-0 relative bottom-0.5",children:n}),t.jsxs(Ce,{children:[t.jsxs(ye,{children:[t.jsx(we,{children:"Add Tag to Item"}),t.jsx(ke,{children:"Search for an existing tag or create a new tag"})]}),t.jsx("div",{className:"mb-4",children:t.jsx(z,{placeholder:"Search tags...",value:u,onChange:C=>h(C.target.value)})}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 max-h-60 overflow-y-auto",children:[f.length===0?t.jsx("p",{className:"text-sm text-muted-foreground",children:"No tags found"}):f.map(C=>t.jsx(Nn,{asChild:!0,children:t.jsx(Kn,{className:"cursor-pointer",tag:C,onClick:()=>x(C.id)})},C.id)),t.jsxs(Xe,{className:"cursor-help",onClick:()=>m("tag"),children:["Custom Tag",t.jsx(re,{})]})]}),t.jsx(Ne,{children:t.jsx(Nn,{asChild:!0,children:t.jsx(D,{children:"Cancel"})})})]})]})}function xr({items:e,className:n}){const{openDialog:r}=nt();return t.jsxs(yt,{className:n,children:[t.jsx(wt,{children:t.jsx(kt,{className:"text-center",children:t.jsx("h2",{children:"Backpack "})})}),t.jsxs(Nt,{className:"md:flex xl:grid md:flex-row gap-4 h-full",children:[t.jsxs("div",{className:"row-span-1 md:flex-1",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("h3",{className:"font-semibold",children:"Oddements"}),t.jsx(D,{onClick:()=>r("oddement"),size:"icon-sm",className:"h-6 w-6",children:t.jsx(re,{})})]}),t.jsx(Ve,{className:"h-[120px]",children:t.jsx("div",{className:"flex flex-wrap items-center p-2 space-x-2",children:e.oddements.map((s,o)=>t.jsx(mr,{reference:s,index:o},`${s.ref}-${o}`))})})]}),t.jsxs("div",{className:"row-span-1 md:flex-1",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("h3",{className:"font-semibold",children:"Fragments"}),t.jsx(D,{onClick:()=>r("fragment"),size:"icon-sm",className:"h-6 w-6",children:t.jsx(re,{})})]})," ",t.jsx(Ve,{className:"h-[120px]",children:t.jsx("div",{className:"flex flex-wrap items-center p-2 space-x-2",children:e.fragments.map((s,o)=>t.jsx(fr,{reference:s},`${s.ref}-${o}`))})})]}),t.jsxs("div",{className:"row-span-1 md:flex-1",children:[t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("h3",{className:"font-semibold",children:"Camping Gear"}),t.jsx(D,{onClick:()=>r("camping-gear"),size:"icon-sm",className:"h-6 w-6",children:t.jsx(re,{})})]}),t.jsx(Ve,{className:"h-[120px]",children:t.jsx("div",{className:"flex flex-wrap items-center p-2 space-x-2",children:e.campingGear.map((s,o)=>t.jsx(gr,{reference:s},`${s.ref}-${o}`))})})]})]})]})}function vr({character:e,className:n}){return t.jsxs(yt,{className:n,children:[t.jsx(wt,{children:t.jsx(kt,{children:t.jsx("h2",{children:"Character"})})}),t.jsxs(Nt,{className:"p-2 space-y-4",children:[t.jsx(br,{characterSelf:e}),t.jsx(jr,{dispair:e.dispair,hope:e.hope}),t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx(En,{entity:e.fallout,type:"fallout"}),t.jsx(En,{entity:e.curse,type:"curse"})]}),t.jsx(Cr,{clock:e.clock})]})]})}function br({characterSelf:e}){const{updateCharacter:n,character:r}=B(),s=Ra.pick({name:!0,origin:!0,player:!0,path:!0,pronouns:!0,milestones:!0}),o=Me({defaultValues:{name:e.name,origin:e.origin,player:e.player,path:e.path,pronouns:e.pronouns,milestones:e.milestones},validators:{onChange:s},onSubmit:({value:a})=>{n({data:{...r.data,character:{...r.data.character,name:a.name,origin:a.origin,player:a.player,path:a.path,pronouns:a.pronouns,milestones:a.milestones}}})}});return t.jsxs("form",{className:"md:grid grid-cols-2 gap-2 space-y-2 md:space-y-0 items-start",id:"edit-character-self",onSubmit:a=>{a.preventDefault(),o.handleSubmit()},children:[t.jsx(o.Field,{name:"name",listeners:{onChangeDebounceMs:500,onChange:()=>{o.handleSubmit()}},children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,className:"grid grid-cols-[1fr_3fr]",children:[t.jsx(A,{htmlFor:a.name,children:"Name:"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),"aria-invalid":i,placeholder:"Character name",autoComplete:"off"}),i&&t.jsx(F,{className:"col-span-2",errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"origin",listeners:{onChangeDebounceMs:500,onChange:()=>{o.handleSubmit()}},children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,className:"grid grid-cols-[1fr_3fr]",children:[t.jsx(A,{htmlFor:a.name,children:"Origin:"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),"aria-invalid":i,placeholder:"Character origin",autoComplete:"off"}),i&&t.jsx(F,{className:"col-span-2",errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"player",listeners:{onChangeDebounceMs:500,onChange:()=>{o.handleSubmit()}},children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,className:"grid grid-cols-[1fr_3fr]",children:[t.jsx(A,{htmlFor:a.name,children:"Player:"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),"aria-invalid":i,placeholder:"Player name",autoComplete:"off"}),i&&t.jsx(F,{className:"col-span-2",errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"path",listeners:{onChangeDebounceMs:500,onChange:()=>{o.handleSubmit()}},children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,className:"grid grid-cols-[1fr_3fr]",children:[t.jsx(A,{htmlFor:a.name,children:"Path:"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),"aria-invalid":i,placeholder:"Character path",autoComplete:"off"}),i&&t.jsx(F,{className:"col-span-2",errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"pronouns",listeners:{onChangeDebounceMs:500,onChange:()=>{o.handleSubmit()}},children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,className:"grid grid-cols-[1fr_3fr]",children:[t.jsx(A,{htmlFor:a.name,children:"Pronouns:"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),"aria-invalid":i,placeholder:"Character pronouns",autoComplete:"off"}),i&&t.jsx(F,{className:"col-span-2",errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"milestones",listeners:{onChangeDebounceMs:500,onChange:()=>{o.handleSubmit()}},children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,className:"grid grid-cols-[1fr_3fr]",children:[t.jsx(A,{htmlFor:a.name,children:"Milestones:"}),t.jsx(z,{className:"[appearance:textfield]",id:a.name,name:a.name,type:"number",value:a.state.value||"",onBlur:a.handleBlur,onChange:c=>a.handleChange(Number(c.target.value)),"aria-invalid":i,placeholder:"0",autoComplete:"off"}),i&&t.jsx(F,{className:"col-span-2",errors:a.state.meta.errors})]})}})]})}function jr({dispair:e,hope:n}){const{updateCharacter:r,character:s}=B(),o=6,a=l=>{const u=l?Math.min(e+1,o-n):Math.max(e-1,0);r({data:{...s.data,character:{...s.data.character,dispair:u}}})},i=l=>{const u=l?Math.min(n+1,o-e):Math.max(n-1,0);r({data:{...s.data,character:{...s.data.character,hope:u}}})},c=o-(e+n);return t.jsxs("div",{className:"flex flex-col sm:flex-row md:flex-col lg:flex-row text-center space-y-2 md:space-y-0 items-center",children:[t.jsxs("div",{className:"flex-1 flex items-center gap-2 flex-col sm:flex-row md:flex-col lg:flex-row place-content-start",children:[t.jsx(D,{size:"icon",onClick:()=>a(!0),children:t.jsx(re,{})}),t.jsx("h3",{className:"capitalize",children:"Despair"})]}),t.jsxs("div",{className:" flex gap-2 border-2 rounded-xl p-4 self-center",children:[Array.from({length:e}).map((l,u)=>t.jsx(Za,{className:"aspect-square",checked:!0,onCheckedChange:()=>a(!1)},`despair-${u}`)),Array.from({length:c}).map((l,u)=>t.jsx(gt,{className:"opacity-50 aspect-square",disabled:!0},`placeholder-${u}`)),Array.from({length:n}).map((l,u)=>t.jsx(er,{className:" aspect-square",checked:!0,onCheckedChange:()=>i(!1)},`hope-${u}`))]}),t.jsxs("div",{className:"flex-1 flex items-center gap-4 flex-col sm:flex-row md:flex-col lg:flex-row place-content-end",children:[t.jsx("h3",{className:"capitalize",children:"Hope"}),t.jsx(D,{size:"icon",onClick:()=>i(!0),children:t.jsx(re,{})})]})]})}function En({entity:e,type:n}){const{updateCharacter:r,character:s}=B(),{getAllSourcesDataArray:o,resolveRefrence:a}=Fe(),i=o("conditions"),c=f=>{s.data.character[n]&&(r({data:{...s.data,character:{...s.data.character,[n]:{...s.data.character[n],currentTrack:f}}}}),f>=e.maxTrack&&setTimeout(()=>{r({data:{...s.data,character:{...s.data.character,[n]:{...s.data.character[n],currentTrack:0,level:e.level+1}}}})},1e3))},l=f=>{s.data.character[n]&&r(f==="none"?{data:{...s.data,character:{...s.data.character,[n]:{...s.data.character[n],condition:"",level:0}}}}:{data:{...s.data,character:{...s.data.character,[n]:{...s.data.character[n],condition:f,level:1}}}})},u=f=>{if(!s.data.character[n])return;const x=f===""?0:Number(f);r({data:{...s.data,character:{...s.data.character,[n]:{...s.data.character[n],level:x}}}})},h=e.condition?a(e.condition,"conditions"):"";function m(){if(!h||e.level===0)return null;const f=h.levels.find(x=>x.level===e.level);return f?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"font-bold",children:["Level ",e.level,":"]}),t.jsx("p",{children:f.description})]}):e.level>h.levels.length?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"font-bold",children:"Final Moment:"}),t.jsx("p",{children:h.finalMoment})]}):null}return t.jsxs("div",{className:"grid gap-2 grid-cols-1 sm:grid-cols-[3fr_8fr]",children:[t.jsx("h3",{className:"text-xl uppercase w-20 pt-1",children:n}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex flex-col justify-center gap-2",children:t.jsx(z,{type:"number",className:"w-10 h-10 text-center p-0 rounded-full border-2 [appearance:textfield]",value:e.level||"",onChange:f=>u(f.target.value)})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-col lg:flex-row xl:flex-col 2xl:flex-row",children:[t.jsxs(Qe,{children:[t.jsx(Ze,{asChild:!0,children:t.jsx("p",{className:"cursor-help underline decoration-dotted",children:"Condition:"})}),t.jsx(et,{className:"w-80",children:h&&e.level>=0?t.jsx("div",{className:"text-sm space-y-2",children:m()}):t.jsx("p",{className:"text-sm text-muted-foreground",children:"No condition selected"})})]}),t.jsxs(Rt,{defaultValue:e.condition||"none",onValueChange:l,children:[t.jsx(Et,{className:"w-[180px]",children:t.jsx(Tt,{placeholder:"Select condition"})}),t.jsxs(At,{children:[t.jsx(X,{value:"none",children:"None"}),i&&i.filter(f=>f.type===n).map(f=>t.jsxs(Ea,{children:[t.jsx(Ta,{asChild:!0,children:t.jsx(X,{value:f.id,children:f.name})}),t.jsx(Aa,{side:"right",children:f.description})]},f.id))]})]})]}),t.jsx(Ye,{track:e.currentTrack,maxTrack:e.maxTrack,onChange:f=>c(f)})]})]})]})}function Cr({clock:e}){const{updateCharacter:n,character:r}=B(),s=(o,a)=>{r.data.character.clock&&n({data:{...r.data,character:{...r.data.character,clock:{...r.data.character.clock,[o]:a}}}})};return t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-between",children:[t.jsxs("div",{className:"flex flex-col p-2 gap-2",children:[t.jsx("p",{className:"text-xl uppercase",children:"Ticking Clock"}),t.jsxs("div",{className:"grid grid-cols-[2fr_3fr]",children:[t.jsx("p",{children:"Food:"}),t.jsx("div",{className:"grow flex justify-center items-center",children:t.jsx(Ye,{track:e.food,maxTrack:2,onChange:o=>s("food",o)})})]}),t.jsxs("div",{className:"grid grid-cols-[2fr_3fr]",children:[t.jsx("p",{children:"Sleep:"}),t.jsx("div",{className:"grow flex justify-center items-center",children:t.jsx(Ye,{track:e.sleep,maxTrack:2,onChange:o=>s("sleep",o)})})]})]}),t.jsx("div",{className:"flex flex-1 flex-col items-center justify-center gap-4",children:t.jsxs("div",{className:"relative w-32 h-32 shrink-0",children:[t.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-primary"}),t.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 border-2 rounded-full flex items-center justify-between bg-secondary px-3 py-1 min-w-40",children:[t.jsx("p",{className:"text-sm font-semibold whitespace-nowrap",children:"Dawn"}),t.jsx("p",{className:"text-sm font-semibold whitespace-nowrap",children:"Dusk"})]}),t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 border-2 p-2 rounded-full flex items-center justify-center bg-background z-10",children:t.jsx(sr,{className:"w-7 h-7 "})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-3 flex gap-3",children:[0,1,2].map(o=>t.jsx("div",{className:"w-5 h-6 shrink-0",style:{transform:`translateY(${Math.abs(o-1)*10}px)`},children:t.jsx(gt,{className:"rounded-full",checked:e.dawnDusk>o,onCheckedChange:()=>{s("dawnDusk",e.dawnDusk>o?o:o+1)}})},`top-${o}`))}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-2 flex gap-3",children:[3,4,5].map(o=>t.jsx("div",{className:"w-5 h-6 shrink-0",style:{transform:`translateY(-${Math.abs(o-4)*10}px)`},children:t.jsx(gt,{className:"rounded-full",checked:e.dawnDusk>o,onCheckedChange:()=>{s("dawnDusk",e.dawnDusk>o?o:o+1)}})},`bottom-${o}`))})]})})]})}function yr({...e}){return t.jsx(Fa,{"data-slot":"sheet",...e})}function wr({...e}){return t.jsx(Ma,{"data-slot":"sheet-trigger",...e})}function kr({...e}){return t.jsx(Hn,{"data-slot":"sheet-close",...e})}function Nr({...e}){return t.jsx(za,{"data-slot":"sheet-portal",...e})}function Sr({className:e,...n}){return t.jsx($a,{"data-slot":"sheet-overlay",className:fe("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...n})}function Dr({className:e,children:n,side:r="right",...s}){return t.jsxs(Nr,{children:[t.jsx(Sr,{}),t.jsxs(Oa,{"data-slot":"sheet-content",className:fe("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",r==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",r==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",r==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",r==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",e),...s,children:[n,t.jsxs(Hn,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[t.jsx(Ba,{className:"size-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Rr({className:e,...n}){return t.jsx("div",{"data-slot":"sheet-header",className:fe("flex flex-col gap-1.5 p-4",e),...n})}function Er({className:e,...n}){return t.jsx("div",{"data-slot":"sheet-footer",className:fe("mt-auto flex flex-col gap-2 p-4",e),...n})}function Tr({className:e,...n}){return t.jsx(Ia,{"data-slot":"sheet-title",className:fe("text-foreground font-semibold",e),...n})}function Ar({className:e,...n}){return t.jsx(La,{"data-slot":"sheet-description",className:fe("text-muted-foreground text-sm",e),...n})}const Mt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Oe(e){const n=Object.prototype.toString.call(e);return n==="[object Window]"||n==="[object global]"}function en(e){return"nodeType"in e}function G(e){var n,r;return e?Oe(e)?e:en(e)&&(n=(r=e.ownerDocument)==null?void 0:r.defaultView)!=null?n:window:window}function tn(e){const{Document:n}=G(e);return e instanceof n}function at(e){return Oe(e)?!1:e instanceof G(e).HTMLElement}function _n(e){return e instanceof G(e).SVGElement}function Be(e){return e?Oe(e)?e.document:en(e)?tn(e)?e:at(e)||_n(e)?e.ownerDocument:document:document:document}const se=Mt?d.useLayoutEffect:d.useEffect;function Ot(e){const n=d.useRef(e);return se(()=>{n.current=e}),d.useCallback(function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return n.current==null?void 0:n.current(...s)},[])}function Fr(){const e=d.useRef(null),n=d.useCallback((s,o)=>{e.current=setInterval(s,o)},[]),r=d.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[n,r]}function Ue(e,n){n===void 0&&(n=[e]);const r=d.useRef(e);return se(()=>{r.current!==e&&(r.current=e)},n),r}function rt(e,n){const r=d.useRef();return d.useMemo(()=>{const s=e(r.current);return r.current=s,s},[...n])}function pt(e){const n=Ot(e),r=d.useRef(null),s=d.useCallback(o=>{o!==r.current&&n?.(o,r.current),r.current=o},[]);return[r,s]}function xt(e){const n=d.useRef();return d.useEffect(()=>{n.current=e},[e]),n.current}let qt={};function Bt(e,n){return d.useMemo(()=>{if(n)return n;const r=qt[e]==null?0:qt[e]+1;return qt[e]=r,e+"-"+r},[e,n])}function Xn(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s.reduce((a,i)=>{const c=Object.entries(i);for(const[l,u]of c){const h=a[l];h!=null&&(a[l]=h+e*u)}return a},{...n})}}const Ae=Xn(1),vt=Xn(-1);function Mr(e){return"clientX"in e&&"clientY"in e}function nn(e){if(!e)return!1;const{KeyboardEvent:n}=G(e.target);return n&&e instanceof n}function Or(e){if(!e)return!1;const{TouchEvent:n}=G(e.target);return n&&e instanceof n}function bt(e){if(Or(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:r}=e.touches[0];return{x:n,y:r}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:r}=e.changedTouches[0];return{x:n,y:r}}}return Mr(e)?{x:e.clientX,y:e.clientY}:null}const We=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:r}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:r}=e;return"scaleX("+n+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[We.Translate.toString(e),We.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:r,easing:s}=e;return n+" "+r+"ms "+s}}}),Tn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Br(e){return e.matches(Tn)?e:e.querySelector(Tn)}const Ir={display:"none"};function Lr(e){let{id:n,value:r}=e;return M.createElement("div",{id:n,style:Ir},r)}function zr(e){let{id:n,announcement:r,ariaLiveType:s="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return M.createElement("div",{id:n,style:o,role:"status","aria-live":s,"aria-atomic":!0},r)}function $r(){const[e,n]=d.useState("");return{announce:d.useCallback(s=>{s!=null&&n(s)},[]),announcement:e}}const Yn=d.createContext(null);function Pr(e){const n=d.useContext(Yn);d.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}function Vr(){const[e]=d.useState(()=>new Set),n=d.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[d.useCallback(s=>{let{type:o,event:a}=s;e.forEach(i=>{var c;return(c=i[o])==null?void 0:c.call(i,a)})},[e]),n]}const Gr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},qr={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:r}=e;return r?"Draggable item "+n.id+" was moved over droppable area "+r.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:r}=e;return r?"Draggable item "+n.id+" was dropped over droppable area "+r.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function Hr(e){let{announcements:n=qr,container:r,hiddenTextDescribedById:s,screenReaderInstructions:o=Gr}=e;const{announce:a,announcement:i}=$r(),c=Bt("DndLiveRegion"),[l,u]=d.useState(!1);if(d.useEffect(()=>{u(!0)},[]),Pr(d.useMemo(()=>({onDragStart(m){let{active:f}=m;a(n.onDragStart({active:f}))},onDragMove(m){let{active:f,over:x}=m;n.onDragMove&&a(n.onDragMove({active:f,over:x}))},onDragOver(m){let{active:f,over:x}=m;a(n.onDragOver({active:f,over:x}))},onDragEnd(m){let{active:f,over:x}=m;a(n.onDragEnd({active:f,over:x}))},onDragCancel(m){let{active:f,over:x}=m;a(n.onDragCancel({active:f,over:x}))}}),[a,n])),!l)return null;const h=M.createElement(M.Fragment,null,M.createElement(Lr,{id:s,value:o.draggable}),M.createElement(zr,{id:c,announcement:i}));return r?Pe.createPortal(h,r):h}var L;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(L||(L={}));function jt(){}const J=Object.freeze({x:0,y:0});function Kr(e,n){const r=bt(e);if(!r)return"0 0";const s={x:(r.x-n.left)/n.width*100,y:(r.y-n.top)/n.height*100};return s.x+"% "+s.y+"%"}function _r(e,n){let{data:{value:r}}=e,{data:{value:s}}=n;return s-r}function Xr(e,n){if(!e||e.length===0)return null;const[r]=e;return r[n]}function Yr(e,n){const r=Math.max(n.top,e.top),s=Math.max(n.left,e.left),o=Math.min(n.left+n.width,e.left+e.width),a=Math.min(n.top+n.height,e.top+e.height),i=o-s,c=a-r;if(s<o&&r<a){const l=n.width*n.height,u=e.width*e.height,h=i*c,m=h/(l+u-h);return Number(m.toFixed(4))}return 0}const Ur=e=>{let{collisionRect:n,droppableRects:r,droppableContainers:s}=e;const o=[];for(const a of s){const{id:i}=a,c=r.get(i);if(c){const l=Yr(c,n);l>0&&o.push({id:i,data:{droppableContainer:a,value:l}})}}return o.sort(_r)};function Wr(e,n,r){return{...e,scaleX:n&&r?n.width/r.width:1,scaleY:n&&r?n.height/r.height:1}}function Un(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:J}function Jr(e){return function(r){for(var s=arguments.length,o=new Array(s>1?s-1:0),a=1;a<s;a++)o[a-1]=arguments[a];return o.reduce((i,c)=>({...i,top:i.top+e*c.y,bottom:i.bottom+e*c.y,left:i.left+e*c.x,right:i.right+e*c.x}),{...r})}}const Qr=Jr(1);function Wn(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}else if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}function Zr(e,n,r){const s=Wn(n);if(!s)return e;const{scaleX:o,scaleY:a,x:i,y:c}=s,l=e.left-i-(1-o)*parseFloat(r),u=e.top-c-(1-a)*parseFloat(r.slice(r.indexOf(" ")+1)),h=o?e.width/o:e.width,m=a?e.height/a:e.height;return{width:h,height:m,top:u,right:l+h,bottom:u+m,left:l}}const es={ignoreTransform:!1};function st(e,n){n===void 0&&(n=es);let r=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:u,transformOrigin:h}=G(e).getComputedStyle(e);u&&(r=Zr(r,u,h))}const{top:s,left:o,width:a,height:i,bottom:c,right:l}=r;return{top:s,left:o,width:a,height:i,bottom:c,right:l}}function An(e){return st(e,{ignoreTransform:!0})}function ts(e){const n=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:n,bottom:r,width:n,height:r}}function ns(e,n){return n===void 0&&(n=G(e).getComputedStyle(e)),n.position==="fixed"}function as(e,n){n===void 0&&(n=G(e).getComputedStyle(e));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const a=n[o];return typeof a=="string"?r.test(a):!1})}function an(e,n){const r=[];function s(o){if(n!=null&&r.length>=n||!o)return r;if(tn(o)&&o.scrollingElement!=null&&!r.includes(o.scrollingElement))return r.push(o.scrollingElement),r;if(!at(o)||_n(o)||r.includes(o))return r;const a=G(e).getComputedStyle(o);return o!==e&&as(o,a)&&r.push(o),ns(o,a)?r:s(o.parentNode)}return e?s(e):r}function Jn(e){const[n]=an(e,1);return n??null}function Ht(e){return!Mt||!e?null:Oe(e)?e:en(e)?tn(e)||e===Be(e).scrollingElement?window:at(e)?e:null:null}function Qn(e){return Oe(e)?e.scrollX:e.scrollLeft}function Zn(e){return Oe(e)?e.scrollY:e.scrollTop}function Yt(e){return{x:Qn(e),y:Zn(e)}}var $;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})($||($={}));function ea(e){return!Mt||!e?!1:e===document.scrollingElement}function ta(e){const n={x:0,y:0},r=ea(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height},o=e.scrollTop<=n.y,a=e.scrollLeft<=n.x,i=e.scrollTop>=s.y,c=e.scrollLeft>=s.x;return{isTop:o,isLeft:a,isBottom:i,isRight:c,maxScroll:s,minScroll:n}}const rs={x:.2,y:.2};function ss(e,n,r,s,o){let{top:a,left:i,right:c,bottom:l}=r;s===void 0&&(s=10),o===void 0&&(o=rs);const{isTop:u,isBottom:h,isLeft:m,isRight:f}=ta(e),x={x:0,y:0},C={x:0,y:0},v={height:n.height*o.y,width:n.width*o.x};return!u&&a<=n.top+v.height?(x.y=$.Backward,C.y=s*Math.abs((n.top+v.height-a)/v.height)):!h&&l>=n.bottom-v.height&&(x.y=$.Forward,C.y=s*Math.abs((n.bottom-v.height-l)/v.height)),!f&&c>=n.right-v.width?(x.x=$.Forward,C.x=s*Math.abs((n.right-v.width-c)/v.width)):!m&&i<=n.left+v.width&&(x.x=$.Backward,C.x=s*Math.abs((n.left+v.width-i)/v.width)),{direction:x,speed:C}}function os(e){if(e===document.scrollingElement){const{innerWidth:a,innerHeight:i}=window;return{top:0,left:0,right:a,bottom:i,width:a,height:i}}const{top:n,left:r,right:s,bottom:o}=e.getBoundingClientRect();return{top:n,left:r,right:s,bottom:o,width:e.clientWidth,height:e.clientHeight}}function na(e){return e.reduce((n,r)=>Ae(n,Yt(r)),J)}function is(e){return e.reduce((n,r)=>n+Qn(r),0)}function cs(e){return e.reduce((n,r)=>n+Zn(r),0)}function aa(e,n){if(n===void 0&&(n=st),!e)return;const{top:r,left:s,bottom:o,right:a}=n(e);Jn(e)&&(o<=0||a<=0||r>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const ls=[["x",["left","right"],is],["y",["top","bottom"],cs]];class rn{constructor(n,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=an(r),o=na(s);this.rect={...n},this.width=n.width,this.height=n.height;for(const[a,i,c]of ls)for(const l of i)Object.defineProperty(this,l,{get:()=>{const u=c(s),h=o[a]-u;return this.rect[l]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ge{constructor(n){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...r)})},this.target=n}add(n,r,s){var o;(o=this.target)==null||o.addEventListener(n,r,s),this.listeners.push([n,r,s])}}function ds(e){const{EventTarget:n}=G(e);return e instanceof n?e:Be(e)}function Kt(e,n){const r=Math.abs(e.x),s=Math.abs(e.y);return typeof n=="number"?Math.sqrt(r**2+s**2)>n:"x"in n&&"y"in n?r>n.x&&s>n.y:"x"in n?r>n.x:"y"in n?s>n.y:!1}var Y;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Y||(Y={}));function Fn(e){e.preventDefault()}function us(e){e.stopPropagation()}var R;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(R||(R={}));const ra={start:[R.Space,R.Enter],cancel:[R.Esc],end:[R.Space,R.Enter,R.Tab]},hs=(e,n)=>{let{currentCoordinates:r}=n;switch(e.code){case R.Right:return{...r,x:r.x+25};case R.Left:return{...r,x:r.x-25};case R.Down:return{...r,y:r.y+25};case R.Up:return{...r,y:r.y-25}}};class sa{constructor(n){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=n;const{event:{target:r}}=n;this.props=n,this.listeners=new Ge(Be(r)),this.windowListeners=new Ge(G(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Y.Resize,this.handleCancel),this.windowListeners.add(Y.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Y.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:n,onStart:r}=this.props,s=n.node.current;s&&aa(s),r(J)}handleKeyDown(n){if(nn(n)){const{active:r,context:s,options:o}=this.props,{keyboardCodes:a=ra,coordinateGetter:i=hs,scrollBehavior:c="smooth"}=o,{code:l}=n;if(a.end.includes(l)){this.handleEnd(n);return}if(a.cancel.includes(l)){this.handleCancel(n);return}const{collisionRect:u}=s.current,h=u?{x:u.left,y:u.top}:J;this.referenceCoordinates||(this.referenceCoordinates=h);const m=i(n,{active:r,context:s.current,currentCoordinates:h});if(m){const f=vt(m,h),x={x:0,y:0},{scrollableAncestors:C}=s.current;for(const v of C){const b=n.code,{isTop:j,isRight:y,isLeft:g,isBottom:N,maxScroll:S,minScroll:w}=ta(v),p=os(v),k={x:Math.min(b===R.Right?p.right-p.width/2:p.right,Math.max(b===R.Right?p.left:p.left+p.width/2,m.x)),y:Math.min(b===R.Down?p.bottom-p.height/2:p.bottom,Math.max(b===R.Down?p.top:p.top+p.height/2,m.y))},E=b===R.Right&&!y||b===R.Left&&!g,I=b===R.Down&&!N||b===R.Up&&!j;if(E&&k.x!==m.x){const O=v.scrollLeft+f.x,ee=b===R.Right&&O<=S.x||b===R.Left&&O>=w.x;if(ee&&!f.y){v.scrollTo({left:O,behavior:c});return}ee?x.x=v.scrollLeft-O:x.x=b===R.Right?v.scrollLeft-S.x:v.scrollLeft-w.x,x.x&&v.scrollBy({left:-x.x,behavior:c});break}else if(I&&k.y!==m.y){const O=v.scrollTop+f.y,ee=b===R.Down&&O<=S.y||b===R.Up&&O>=w.y;if(ee&&!f.x){v.scrollTo({top:O,behavior:c});return}ee?x.y=v.scrollTop-O:x.y=b===R.Down?v.scrollTop-S.y:v.scrollTop-w.y,x.y&&v.scrollBy({top:-x.y,behavior:c});break}}this.handleMove(n,Ae(vt(m,this.referenceCoordinates),x))}}}handleMove(n,r){const{onMove:s}=this.props;n.preventDefault(),s(r)}handleEnd(n){const{onEnd:r}=this.props;n.preventDefault(),this.detach(),r()}handleCancel(n){const{onCancel:r}=this.props;n.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}sa.activators=[{eventName:"onKeyDown",handler:(e,n,r)=>{let{keyboardCodes:s=ra,onActivation:o}=n,{active:a}=r;const{code:i}=e.nativeEvent;if(s.start.includes(i)){const c=a.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),o?.({event:e.nativeEvent}),!0)}return!1}}];function Mn(e){return!!(e&&"distance"in e)}function On(e){return!!(e&&"delay"in e)}class sn{constructor(n,r,s){var o;s===void 0&&(s=ds(n.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=n,this.events=r;const{event:a}=n,{target:i}=a;this.props=n,this.events=r,this.document=Be(i),this.documentListeners=new Ge(this.document),this.listeners=new Ge(s),this.windowListeners=new Ge(G(i)),this.initialCoordinates=(o=bt(a))!=null?o:J,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:n,props:{options:{activationConstraint:r,bypassActivationConstraint:s}}}=this;if(this.listeners.add(n.move.name,this.handleMove,{passive:!1}),this.listeners.add(n.end.name,this.handleEnd),n.cancel&&this.listeners.add(n.cancel.name,this.handleCancel),this.windowListeners.add(Y.Resize,this.handleCancel),this.windowListeners.add(Y.DragStart,Fn),this.windowListeners.add(Y.VisibilityChange,this.handleCancel),this.windowListeners.add(Y.ContextMenu,Fn),this.documentListeners.add(Y.Keydown,this.handleKeydown),r){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(On(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(Mn(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(n,r){const{active:s,onPending:o}=this.props;o(s,n,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:n}=this,{onStart:r}=this.props;n&&(this.activated=!0,this.documentListeners.add(Y.Click,us,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Y.SelectionChange,this.removeTextSelection),r(n))}handleMove(n){var r;const{activated:s,initialCoordinates:o,props:a}=this,{onMove:i,options:{activationConstraint:c}}=a;if(!o)return;const l=(r=bt(n))!=null?r:J,u=vt(o,l);if(!s&&c){if(Mn(c)){if(c.tolerance!=null&&Kt(u,c.tolerance))return this.handleCancel();if(Kt(u,c.distance))return this.handleStart()}if(On(c)&&Kt(u,c.tolerance))return this.handleCancel();this.handlePending(c,u);return}n.cancelable&&n.preventDefault(),i(l)}handleEnd(){const{onAbort:n,onEnd:r}=this.props;this.detach(),this.activated||n(this.props.active),r()}handleCancel(){const{onAbort:n,onCancel:r}=this.props;this.detach(),this.activated||n(this.props.active),r()}handleKeydown(n){n.code===R.Esc&&this.handleCancel()}removeTextSelection(){var n;(n=this.document.getSelection())==null||n.removeAllRanges()}}const ms={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class oa extends sn{constructor(n){const{event:r}=n,s=Be(r.target);super(n,ms,s)}}oa.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:s}=n;return!r.isPrimary||r.button!==0?!1:(s?.({event:r}),!0)}}];const fs={move:{name:"mousemove"},end:{name:"mouseup"}};var Ut;(function(e){e[e.RightClick=2]="RightClick"})(Ut||(Ut={}));class gs extends sn{constructor(n){super(n,fs,Be(n.event.target))}}gs.activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:s}=n;return r.button===Ut.RightClick?!1:(s?.({event:r}),!0)}}];const _t={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class ps extends sn{constructor(n){super(n,_t)}static setup(){return window.addEventListener(_t.move.name,n,{capture:!1,passive:!1}),function(){window.removeEventListener(_t.move.name,n)};function n(){}}}ps.activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:s}=n;const{touches:o}=r;return o.length>1?!1:(s?.({event:r}),!0)}}];var qe;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(qe||(qe={}));var Ct;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ct||(Ct={}));function xs(e){let{acceleration:n,activator:r=qe.Pointer,canScroll:s,draggingRect:o,enabled:a,interval:i=5,order:c=Ct.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:h,delta:m,threshold:f}=e;const x=bs({delta:m,disabled:!a}),[C,v]=Fr(),b=d.useRef({x:0,y:0}),j=d.useRef({x:0,y:0}),y=d.useMemo(()=>{switch(r){case qe.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case qe.DraggableRect:return o}},[r,o,l]),g=d.useRef(null),N=d.useCallback(()=>{const w=g.current;if(!w)return;const p=b.current.x*j.current.x,k=b.current.y*j.current.y;w.scrollBy(p,k)},[]),S=d.useMemo(()=>c===Ct.TreeOrder?[...u].reverse():u,[c,u]);d.useEffect(()=>{if(!a||!u.length||!y){v();return}for(const w of S){if(s?.(w)===!1)continue;const p=u.indexOf(w),k=h[p];if(!k)continue;const{direction:E,speed:I}=ss(w,k,y,n,f);for(const O of["x","y"])x[O][E[O]]||(I[O]=0,E[O]=0);if(I.x>0||I.y>0){v(),g.current=w,C(N,i),b.current=I,j.current=E;return}}b.current={x:0,y:0},j.current={x:0,y:0},v()},[n,N,s,v,a,i,JSON.stringify(y),JSON.stringify(x),C,u,S,h,JSON.stringify(f)])}const vs={x:{[$.Backward]:!1,[$.Forward]:!1},y:{[$.Backward]:!1,[$.Forward]:!1}};function bs(e){let{delta:n,disabled:r}=e;const s=xt(n);return rt(o=>{if(r||!s||!o)return vs;const a={x:Math.sign(n.x-s.x),y:Math.sign(n.y-s.y)};return{x:{[$.Backward]:o.x[$.Backward]||a.x===-1,[$.Forward]:o.x[$.Forward]||a.x===1},y:{[$.Backward]:o.y[$.Backward]||a.y===-1,[$.Forward]:o.y[$.Forward]||a.y===1}}},[r,n,s])}function js(e,n){const r=n!=null?e.get(n):void 0,s=r?r.node.current:null;return rt(o=>{var a;return n==null?null:(a=s??o)!=null?a:null},[s,n])}function Cs(e,n){return d.useMemo(()=>e.reduce((r,s)=>{const{sensor:o}=s,a=o.activators.map(i=>({eventName:i.eventName,handler:n(i.handler,s)}));return[...r,...a]},[]),[e,n])}var Je;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Je||(Je={}));var Wt;(function(e){e.Optimized="optimized"})(Wt||(Wt={}));const Bn=new Map;function ys(e,n){let{dragging:r,dependencies:s,config:o}=n;const[a,i]=d.useState(null),{frequency:c,measure:l,strategy:u}=o,h=d.useRef(e),m=b(),f=Ue(m),x=d.useCallback(function(j){j===void 0&&(j=[]),!f.current&&i(y=>y===null?j:y.concat(j.filter(g=>!y.includes(g))))},[f]),C=d.useRef(null),v=rt(j=>{if(m&&!r)return Bn;if(!j||j===Bn||h.current!==e||a!=null){const y=new Map;for(let g of e){if(!g)continue;if(a&&a.length>0&&!a.includes(g.id)&&g.rect.current){y.set(g.id,g.rect.current);continue}const N=g.node.current,S=N?new rn(l(N),N):null;g.rect.current=S,S&&y.set(g.id,S)}return y}return j},[e,a,r,m,l]);return d.useEffect(()=>{h.current=e},[e]),d.useEffect(()=>{m||x()},[r,m]),d.useEffect(()=>{a&&a.length>0&&i(null)},[JSON.stringify(a)]),d.useEffect(()=>{m||typeof c!="number"||C.current!==null||(C.current=setTimeout(()=>{x(),C.current=null},c))},[c,m,x,...s]),{droppableRects:v,measureDroppableContainers:x,measuringScheduled:a!=null};function b(){switch(u){case Je.Always:return!1;case Je.BeforeDragging:return r;default:return!r}}}function on(e,n){return rt(r=>e?r||(typeof n=="function"?n(e):e):null,[n,e])}function ws(e,n){return on(e,n)}function ks(e){let{callback:n,disabled:r}=e;const s=Ot(n),o=d.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(s)},[s,r]);return d.useEffect(()=>()=>o?.disconnect(),[o]),o}function It(e){let{callback:n,disabled:r}=e;const s=Ot(n),o=d.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(s)},[r]);return d.useEffect(()=>()=>o?.disconnect(),[o]),o}function Ns(e){return new rn(st(e),e)}function In(e,n,r){n===void 0&&(n=Ns);const[s,o]=d.useState(null);function a(){o(l=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=l??r)!=null?u:null}const h=n(e);return JSON.stringify(l)===JSON.stringify(h)?l:h})}const i=ks({callback(l){if(e)for(const u of l){const{type:h,target:m}=u;if(h==="childList"&&m instanceof HTMLElement&&m.contains(e)){a();break}}}}),c=It({callback:a});return se(()=>{a(),e?(c?.observe(e),i?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),i?.disconnect())},[e]),s}function Ss(e){const n=on(e);return Un(e,n)}const Ln=[];function Ds(e){const n=d.useRef(e),r=rt(s=>e?s&&s!==Ln&&e&&n.current&&e.parentNode===n.current.parentNode?s:an(e):Ln,[e]);return d.useEffect(()=>{n.current=e},[e]),r}function Rs(e){const[n,r]=d.useState(null),s=d.useRef(e),o=d.useCallback(a=>{const i=Ht(a.target);i&&r(c=>c?(c.set(i,Yt(i)),new Map(c)):null)},[]);return d.useEffect(()=>{const a=s.current;if(e!==a){i(a);const c=e.map(l=>{const u=Ht(l);return u?(u.addEventListener("scroll",o,{passive:!0}),[u,Yt(u)]):null}).filter(l=>l!=null);r(c.length?new Map(c):null),s.current=e}return()=>{i(e),i(a)};function i(c){c.forEach(l=>{const u=Ht(l);u?.removeEventListener("scroll",o)})}},[o,e]),d.useMemo(()=>e.length?n?Array.from(n.values()).reduce((a,i)=>Ae(a,i),J):na(e):J,[e,n])}function zn(e,n){n===void 0&&(n=[]);const r=d.useRef(null);return d.useEffect(()=>{r.current=null},n),d.useEffect(()=>{const s=e!==J;s&&!r.current&&(r.current=e),!s&&r.current&&(r.current=null)},[e]),r.current?vt(e,r.current):J}function Es(e){d.useEffect(()=>{if(!Mt)return;const n=e.map(r=>{let{sensor:s}=r;return s.setup==null?void 0:s.setup()});return()=>{for(const r of n)r?.()}},e.map(n=>{let{sensor:r}=n;return r}))}function Ts(e,n){return d.useMemo(()=>e.reduce((r,s)=>{let{eventName:o,handler:a}=s;return r[o]=i=>{a(i,n)},r},{}),[e,n])}function ia(e){return d.useMemo(()=>e?ts(e):null,[e])}const $n=[];function As(e,n){n===void 0&&(n=st);const[r]=e,s=ia(r?G(r):null),[o,a]=d.useState($n);function i(){a(()=>e.length?e.map(l=>ea(l)?s:new rn(n(l),l)):$n)}const c=It({callback:i});return se(()=>{c?.disconnect(),i(),e.forEach(l=>c?.observe(l))},[e]),o}function ca(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return at(n)?n:e}function Fs(e){let{measure:n}=e;const[r,s]=d.useState(null),o=d.useCallback(u=>{for(const{target:h}of u)if(at(h)){s(m=>{const f=n(h);return m?{...m,width:f.width,height:f.height}:f});break}},[n]),a=It({callback:o}),i=d.useCallback(u=>{const h=ca(u);a?.disconnect(),h&&a?.observe(h),s(h?n(h):null)},[n,a]),[c,l]=pt(i);return d.useMemo(()=>({nodeRef:c,rect:r,setRef:l}),[r,c,l])}const Ms=[{sensor:oa,options:{}},{sensor:sa,options:{}}],Os={current:{}},ft={draggable:{measure:An},droppable:{measure:An,strategy:Je.WhileDragging,frequency:Wt.Optimized},dragOverlay:{measure:st}};class He extends Map{get(n){var r;return n!=null&&(r=super.get(n))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(n=>{let{disabled:r}=n;return!r})}getNodeFor(n){var r,s;return(r=(s=this.get(n))==null?void 0:s.node.current)!=null?r:void 0}}const Bs={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new He,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:jt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ft,measureDroppableContainers:jt,windowRect:null,measuringScheduled:!1},la={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:jt,draggableNodes:new Map,over:null,measureDroppableContainers:jt},ot=d.createContext(la),da=d.createContext(Bs);function Is(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new He}}}function Ls(e,n){switch(n.type){case L.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case L.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case L.DragEnd:case L.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case L.RegisterDroppable:{const{element:r}=n,{id:s}=r,o=new He(e.droppable.containers);return o.set(s,r),{...e,droppable:{...e.droppable,containers:o}}}case L.SetDroppableDisabled:{const{id:r,key:s,disabled:o}=n,a=e.droppable.containers.get(r);if(!a||s!==a.key)return e;const i=new He(e.droppable.containers);return i.set(r,{...a,disabled:o}),{...e,droppable:{...e.droppable,containers:i}}}case L.UnregisterDroppable:{const{id:r,key:s}=n,o=e.droppable.containers.get(r);if(!o||s!==o.key)return e;const a=new He(e.droppable.containers);return a.delete(r),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function zs(e){let{disabled:n}=e;const{active:r,activatorEvent:s,draggableNodes:o}=d.useContext(ot),a=xt(s),i=xt(r?.id);return d.useEffect(()=>{if(!n&&!s&&a&&i!=null){if(!nn(a)||document.activeElement===a.target)return;const c=o.get(i);if(!c)return;const{activatorNode:l,node:u}=c;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const h of[l.current,u.current]){if(!h)continue;const m=Br(h);if(m){m.focus();break}}})}},[s,n,o,i,a]),null}function ua(e,n){let{transform:r,...s}=n;return e!=null&&e.length?e.reduce((o,a)=>a({transform:o,...s}),r):r}function $s(e){return d.useMemo(()=>({draggable:{...ft.draggable,...e?.draggable},droppable:{...ft.droppable,...e?.droppable},dragOverlay:{...ft.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Ps(e){let{activeNode:n,measure:r,initialRect:s,config:o=!0}=e;const a=d.useRef(!1),{x:i,y:c}=typeof o=="boolean"?{x:o,y:o}:o;se(()=>{if(!i&&!c||!n){a.current=!1;return}if(a.current||!s)return;const u=n?.node.current;if(!u||u.isConnected===!1)return;const h=r(u),m=Un(h,s);if(i||(m.x=0),c||(m.y=0),a.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const f=Jn(u);f&&f.scrollBy({top:m.y,left:m.x})}},[n,i,c,s,r])}const Lt=d.createContext({...J,scaleX:1,scaleY:1});var he;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(he||(he={}));const Vs=d.memo(function(n){var r,s,o,a;let{id:i,accessibility:c,autoScroll:l=!0,children:u,sensors:h=Ms,collisionDetection:m=Ur,measuring:f,modifiers:x,...C}=n;const v=d.useReducer(Ls,void 0,Is),[b,j]=v,[y,g]=Vr(),[N,S]=d.useState(he.Uninitialized),w=N===he.Initialized,{draggable:{active:p,nodes:k,translate:E},droppable:{containers:I}}=b,O=p!=null?k.get(p):null,ee=d.useRef({initial:null,translated:null}),te=d.useMemo(()=>{var V;return p!=null?{id:p,data:(V=O?.data)!=null?V:Os,rect:ee}:null},[p,O]),oe=d.useRef(null),[cn,ln]=d.useState(null),[ne,dn]=d.useState(null),ge=Ue(C,Object.values(C)),zt=Bt("DndDescribedBy",i),un=d.useMemo(()=>I.getEnabled(),[I]),pe=$s(f),{droppableRects:Se,measureDroppableContainers:it,measuringScheduled:hn}=ys(un,{dragging:w,dependencies:[E.x,E.y],config:pe.droppable}),U=js(k,p),mn=d.useMemo(()=>ne?bt(ne):null,[ne]),fn=ja(),gn=ws(U,pe.draggable.measure);Ps({activeNode:p!=null?k.get(p):null,config:fn.layoutShiftCompensation,initialRect:gn,measure:pe.draggable.measure});const W=In(U,pe.draggable.measure,gn),$t=In(U?U.parentElement:null),xe=d.useRef({activatorEvent:null,active:null,activeNode:U,collisionRect:null,collisions:null,droppableRects:Se,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:I,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),pn=I.getNodeFor((r=xe.current.over)==null?void 0:r.id),ve=Fs({measure:pe.dragOverlay.measure}),ct=(s=ve.nodeRef.current)!=null?s:U,De=w?(o=ve.rect)!=null?o:W:null,xn=!!(ve.nodeRef.current&&ve.rect),vn=Ss(xn?null:W),Pt=ia(ct?G(ct):null),ie=Ds(w?pn??U:null),lt=As(ie),dt=ua(x,{transform:{x:E.x-vn.x,y:E.y-vn.y,scaleX:1,scaleY:1},activatorEvent:ne,active:te,activeNodeRect:W,containerNodeRect:$t,draggingNodeRect:De,over:xe.current.over,overlayNodeRect:ve.rect,scrollableAncestors:ie,scrollableAncestorRects:lt,windowRect:Pt}),bn=mn?Ae(mn,E):null,jn=Rs(ie),ma=zn(jn),fa=zn(jn,[W]),Re=Ae(dt,ma),Ee=De?Qr(De,dt):null,Ie=te&&Ee?m({active:te,collisionRect:Ee,droppableRects:Se,droppableContainers:un,pointerCoordinates:bn}):null,Cn=Xr(Ie,"id"),[ce,yn]=d.useState(null),ga=xn?dt:Ae(dt,fa),pa=Wr(ga,(a=ce?.rect)!=null?a:null,W),Vt=d.useRef(null),wn=d.useCallback((V,q)=>{let{sensor:H,options:le}=q;if(oe.current==null)return;const _=k.get(oe.current);if(!_)return;const K=V.nativeEvent,Q=new H({active:oe.current,activeNode:_,event:K,options:le,context:xe,onAbort(P){if(!k.get(P))return;const{onDragAbort:Z}=ge.current,ae={id:P};Z?.(ae),y({type:"onDragAbort",event:ae})},onPending(P,de,Z,ae){if(!k.get(P))return;const{onDragPending:ze}=ge.current,ue={id:P,constraint:de,initialCoordinates:Z,offset:ae};ze?.(ue),y({type:"onDragPending",event:ue})},onStart(P){const de=oe.current;if(de==null)return;const Z=k.get(de);if(!Z)return;const{onDragStart:ae}=ge.current,Le={activatorEvent:K,active:{id:de,data:Z.data,rect:ee}};Pe.unstable_batchedUpdates(()=>{ae?.(Le),S(he.Initializing),j({type:L.DragStart,initialCoordinates:P,active:de}),y({type:"onDragStart",event:Le}),ln(Vt.current),dn(K)})},onMove(P){j({type:L.DragMove,coordinates:P})},onEnd:Te(L.DragEnd),onCancel:Te(L.DragCancel)});Vt.current=Q;function Te(P){return async function(){const{active:Z,collisions:ae,over:Le,scrollAdjustedTranslate:ze}=xe.current;let ue=null;if(Z&&ze){const{cancelDrop:$e}=ge.current;ue={activatorEvent:K,active:Z,collisions:ae,delta:ze,over:Le},P===L.DragEnd&&typeof $e=="function"&&await Promise.resolve($e(ue))&&(P=L.DragCancel)}oe.current=null,Pe.unstable_batchedUpdates(()=>{j({type:P}),S(he.Uninitialized),yn(null),ln(null),dn(null),Vt.current=null;const $e=P===L.DragEnd?"onDragEnd":"onDragCancel";if(ue){const Gt=ge.current[$e];Gt?.(ue),y({type:$e,event:ue})}})}}},[k]),xa=d.useCallback((V,q)=>(H,le)=>{const _=H.nativeEvent,K=k.get(le);if(oe.current!==null||!K||_.dndKit||_.defaultPrevented)return;const Q={active:K};V(H,q.options,Q)===!0&&(_.dndKit={capturedBy:q.sensor},oe.current=le,wn(H,q))},[k,wn]),kn=Cs(h,xa);Es(h),se(()=>{W&&N===he.Initializing&&S(he.Initialized)},[W,N]),d.useEffect(()=>{const{onDragMove:V}=ge.current,{active:q,activatorEvent:H,collisions:le,over:_}=xe.current;if(!q||!H)return;const K={active:q,activatorEvent:H,collisions:le,delta:{x:Re.x,y:Re.y},over:_};Pe.unstable_batchedUpdates(()=>{V?.(K),y({type:"onDragMove",event:K})})},[Re.x,Re.y]),d.useEffect(()=>{const{active:V,activatorEvent:q,collisions:H,droppableContainers:le,scrollAdjustedTranslate:_}=xe.current;if(!V||oe.current==null||!q||!_)return;const{onDragOver:K}=ge.current,Q=le.get(Cn),Te=Q&&Q.rect.current?{id:Q.id,rect:Q.rect.current,data:Q.data,disabled:Q.disabled}:null,P={active:V,activatorEvent:q,collisions:H,delta:{x:_.x,y:_.y},over:Te};Pe.unstable_batchedUpdates(()=>{yn(Te),K?.(P),y({type:"onDragOver",event:P})})},[Cn]),se(()=>{xe.current={activatorEvent:ne,active:te,activeNode:U,collisionRect:Ee,collisions:Ie,droppableRects:Se,draggableNodes:k,draggingNode:ct,draggingNodeRect:De,droppableContainers:I,over:ce,scrollableAncestors:ie,scrollAdjustedTranslate:Re},ee.current={initial:De,translated:Ee}},[te,U,Ie,Ee,k,ct,De,Se,I,ce,ie,Re]),xs({...fn,delta:E,draggingRect:Ee,pointerCoordinates:bn,scrollableAncestors:ie,scrollableAncestorRects:lt});const va=d.useMemo(()=>({active:te,activeNode:U,activeNodeRect:W,activatorEvent:ne,collisions:Ie,containerNodeRect:$t,dragOverlay:ve,draggableNodes:k,droppableContainers:I,droppableRects:Se,over:ce,measureDroppableContainers:it,scrollableAncestors:ie,scrollableAncestorRects:lt,measuringConfiguration:pe,measuringScheduled:hn,windowRect:Pt}),[te,U,W,ne,Ie,$t,ve,k,I,Se,ce,it,ie,lt,pe,hn,Pt]),ba=d.useMemo(()=>({activatorEvent:ne,activators:kn,active:te,activeNodeRect:W,ariaDescribedById:{draggable:zt},dispatch:j,draggableNodes:k,over:ce,measureDroppableContainers:it}),[ne,kn,te,W,j,zt,k,ce,it]);return M.createElement(Yn.Provider,{value:g},M.createElement(ot.Provider,{value:ba},M.createElement(da.Provider,{value:va},M.createElement(Lt.Provider,{value:pa},u)),M.createElement(zs,{disabled:c?.restoreFocus===!1})),M.createElement(Hr,{...c,hiddenTextDescribedById:zt}));function ja(){const V=cn?.autoScrollEnabled===!1,q=typeof l=="object"?l.enabled===!1:l===!1,H=w&&!V&&!q;return typeof l=="object"?{...l,enabled:H}:{enabled:H}}}),Gs=d.createContext(null),Pn="button",qs="Draggable";function Hs(e){let{id:n,data:r,disabled:s=!1,attributes:o}=e;const a=Bt(qs),{activators:i,activatorEvent:c,active:l,activeNodeRect:u,ariaDescribedById:h,draggableNodes:m,over:f}=d.useContext(ot),{role:x=Pn,roleDescription:C="draggable",tabIndex:v=0}=o??{},b=l?.id===n,j=d.useContext(b?Lt:Gs),[y,g]=pt(),[N,S]=pt(),w=Ts(i,n),p=Ue(r);se(()=>(m.set(n,{id:n,key:a,node:y,activatorNode:N,data:p}),()=>{const E=m.get(n);E&&E.key===a&&m.delete(n)}),[m,n]);const k=d.useMemo(()=>({role:x,tabIndex:v,"aria-disabled":s,"aria-pressed":b&&x===Pn?!0:void 0,"aria-roledescription":C,"aria-describedby":h.draggable}),[s,x,v,b,C,h.draggable]);return{active:l,activatorEvent:c,activeNodeRect:u,attributes:k,isDragging:b,listeners:s?void 0:w,node:y,over:f,setNodeRef:g,setActivatorNodeRef:S,transform:j}}function Ks(){return d.useContext(da)}const _s="Droppable",Xs={timeout:25};function ha(e){let{data:n,disabled:r=!1,id:s,resizeObserverConfig:o}=e;const a=Bt(_s),{active:i,dispatch:c,over:l,measureDroppableContainers:u}=d.useContext(ot),h=d.useRef({disabled:r}),m=d.useRef(!1),f=d.useRef(null),x=d.useRef(null),{disabled:C,updateMeasurementsFor:v,timeout:b}={...Xs,...o},j=Ue(v??s),y=d.useCallback(()=>{if(!m.current){m.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{u(Array.isArray(j.current)?j.current:[j.current]),x.current=null},b)},[b]),g=It({callback:y,disabled:C||!i}),N=d.useCallback((k,E)=>{g&&(E&&(g.unobserve(E),m.current=!1),k&&g.observe(k))},[g]),[S,w]=pt(N),p=Ue(n);return d.useEffect(()=>{!g||!S.current||(g.disconnect(),m.current=!1,g.observe(S.current))},[S,g]),d.useEffect(()=>(c({type:L.RegisterDroppable,element:{id:s,key:a,disabled:r,node:S,rect:f,data:p}}),()=>c({type:L.UnregisterDroppable,key:a,id:s})),[s]),d.useEffect(()=>{r!==h.current.disabled&&(c({type:L.SetDroppableDisabled,id:s,key:a,disabled:r}),h.current.disabled=r)},[s,a,r,c]),{active:i,rect:f,isOver:l?.id===s,node:S,over:l,setNodeRef:w}}function Ys(e){let{animation:n,children:r}=e;const[s,o]=d.useState(null),[a,i]=d.useState(null),c=xt(r);return!r&&!s&&c&&o(c),se(()=>{if(!a)return;const l=s?.key,u=s?.props.id;if(l==null||u==null){o(null);return}Promise.resolve(n(u,a)).then(()=>{o(null)})},[n,s,a]),M.createElement(M.Fragment,null,r,s?d.cloneElement(s,{ref:i}):null)}const Us={x:0,y:0,scaleX:1,scaleY:1};function Ws(e){let{children:n}=e;return M.createElement(ot.Provider,{value:la},M.createElement(Lt.Provider,{value:Us},n))}const Js={position:"fixed",touchAction:"none"},Qs=e=>nn(e)?"transform 250ms ease":void 0,Zs=d.forwardRef((e,n)=>{let{as:r,activatorEvent:s,adjustScale:o,children:a,className:i,rect:c,style:l,transform:u,transition:h=Qs}=e;if(!c)return null;const m=o?u:{...u,scaleX:1,scaleY:1},f={...Js,width:c.width,height:c.height,top:c.top,left:c.left,transform:We.Transform.toString(m),transformOrigin:o&&s?Kr(s,c):void 0,transition:typeof h=="function"?h(s):h,...l};return M.createElement(r,{className:i,style:f,ref:n},a)}),eo=e=>n=>{let{active:r,dragOverlay:s}=n;const o={},{styles:a,className:i}=e;if(a!=null&&a.active)for(const[c,l]of Object.entries(a.active))l!==void 0&&(o[c]=r.node.style.getPropertyValue(c),r.node.style.setProperty(c,l));if(a!=null&&a.dragOverlay)for(const[c,l]of Object.entries(a.dragOverlay))l!==void 0&&s.node.style.setProperty(c,l);return i!=null&&i.active&&r.node.classList.add(i.active),i!=null&&i.dragOverlay&&s.node.classList.add(i.dragOverlay),function(){for(const[l,u]of Object.entries(o))r.node.style.setProperty(l,u);i!=null&&i.active&&r.node.classList.remove(i.active)}},to=e=>{let{transform:{initial:n,final:r}}=e;return[{transform:We.Transform.toString(n)},{transform:We.Transform.toString(r)}]},no={duration:250,easing:"ease",keyframes:to,sideEffects:eo({styles:{active:{opacity:"0"}}})};function ao(e){let{config:n,draggableNodes:r,droppableContainers:s,measuringConfiguration:o}=e;return Ot((a,i)=>{if(n===null)return;const c=r.get(a);if(!c)return;const l=c.node.current;if(!l)return;const u=ca(i);if(!u)return;const{transform:h}=G(i).getComputedStyle(i),m=Wn(h);if(!m)return;const f=typeof n=="function"?n:ro(n);return aa(l,o.draggable.measure),f({active:{id:a,data:c.data,node:l,rect:o.draggable.measure(l)},draggableNodes:r,dragOverlay:{node:i,rect:o.dragOverlay.measure(u)},droppableContainers:s,measuringConfiguration:o,transform:m})})}function ro(e){const{duration:n,easing:r,sideEffects:s,keyframes:o}={...no,...e};return a=>{let{active:i,dragOverlay:c,transform:l,...u}=a;if(!n)return;const h={x:c.rect.left-i.rect.left,y:c.rect.top-i.rect.top},m={scaleX:l.scaleX!==1?i.rect.width*l.scaleX/c.rect.width:1,scaleY:l.scaleY!==1?i.rect.height*l.scaleY/c.rect.height:1},f={x:l.x-h.x,y:l.y-h.y,...m},x=o({...u,active:i,dragOverlay:c,transform:{initial:l,final:f}}),[C]=x,v=x[x.length-1];if(JSON.stringify(C)===JSON.stringify(v))return;const b=s?.({active:i,dragOverlay:c,...u}),j=c.node.animate(x,{duration:n,easing:r,fill:"forwards"});return new Promise(y=>{j.onfinish=()=>{b?.(),y()}})}}let Vn=0;function so(e){return d.useMemo(()=>{if(e!=null)return Vn++,Vn},[e])}const oo=M.memo(e=>{let{adjustScale:n=!1,children:r,dropAnimation:s,style:o,transition:a,modifiers:i,wrapperElement:c="div",className:l,zIndex:u=999}=e;const{activatorEvent:h,active:m,activeNodeRect:f,containerNodeRect:x,draggableNodes:C,droppableContainers:v,dragOverlay:b,over:j,measuringConfiguration:y,scrollableAncestors:g,scrollableAncestorRects:N,windowRect:S}=Ks(),w=d.useContext(Lt),p=so(m?.id),k=ua(i,{activatorEvent:h,active:m,activeNodeRect:f,containerNodeRect:x,draggingNodeRect:b.rect,over:j,overlayNodeRect:b.rect,scrollableAncestors:g,scrollableAncestorRects:N,transform:w,windowRect:S}),E=on(f),I=ao({config:s,draggableNodes:C,droppableContainers:v,measuringConfiguration:y}),O=E?b.setRef:void 0;return M.createElement(Ws,null,M.createElement(Ys,{animation:I},m&&p?M.createElement(Zs,{key:p,id:m.id,ref:O,as:c,activatorEvent:h,adjustScale:n,className:l,transition:a,rect:E,style:{zIndex:u,...o},transform:k},r):null))});function io({open:e,onOpenChange:n}){const{setNodeRef:r}=ha({id:"sidebar-drop-zone"});return t.jsxs(yr,{open:e,onOpenChange:n,modal:!1,children:[t.jsx(wr,{asChild:!0,children:t.jsx(D,{size:"icon",className:"fixed right-5 top-5 z-50","aria-label":"Open Sidebar",children:t.jsx(or,{})})}),t.jsxs(Dr,{ref:r,className:"max-w-[70vw] md:min-w-[35vw] gap-0",onInteractOutside:s=>{s.preventDefault()},children:[t.jsxs(Rr,{children:[t.jsx(Tr,{children:"Add Oddements, Relics, etc."}),t.jsx(Ar,{children:"Drag and drop items into the sheet, or right click and select amount"})]}),t.jsxs(tr,{defaultValue:"all",className:"px-4 w-full flex-1 min-h-0",children:[t.jsxs(nr,{className:"w-full shrink-0",children:[t.jsx(ut,{value:"all",children:"All"}),t.jsx(ut,{value:"core",children:"Core"}),t.jsx(ut,{value:"extra",children:"Extra"}),t.jsx(ut,{value:"self",children:"Character"})]}),t.jsx(ht,{value:"all",className:"flex-1 min-h-0",children:t.jsx(mt,{type:"all"})}),t.jsx(ht,{value:"core",className:"flex-1 min-h-0",children:t.jsx(mt,{type:"core"})}),t.jsx(ht,{value:"extra",className:"flex-1 min-h-0",children:t.jsx(mt,{type:"extra"})}),t.jsx(ht,{value:"self",className:"flex-1 min-h-0",children:t.jsx(mt,{type:"self"})})]}),t.jsx(Er,{className:"shrink-0",children:t.jsx(kr,{asChild:!0,children:t.jsx(D,{variant:"outline",children:"Close"})})})]})]})}function mt({type:e}){const{getSourceDataArray:n}=Fe(),{character:r,getCharacterDataArray:s}=B(),o=n(r.versionRef,"oddements")??[],a=(r.dependencies??[]).flatMap(p=>n(p,"oddements")??[]),i=s("customOddements")??[],c=n(r.versionRef,"fragments")??[],l=(r.dependencies??[]).flatMap(p=>n(p,"fragments")??[]),u=s("customFragments")??[],h=n(r.versionRef,"campingGear")??[],m=(r.dependencies??[]).flatMap(p=>n(p,"campingGear")??[]),f=s("customCampingGear")??[],x=n(r.versionRef,"aspects")??[],C=(r.dependencies??[]).flatMap(p=>n(p,"aspects")??[]),v=s("customAspects")??[],[b,j]=d.useState("all"),[y,g]=d.useState("");let N=[];(e==="all"||e==="core")&&(N=[...o,...c,...x,...h]),(e==="all"||e==="extra")&&(N=[...N,...a,...l,...C,...m]),(e==="all"||e==="self")&&(N=[...N,...i,...u,...v,...f]);const w=N.filter(p=>b==="all"||"tags"in p||!("type"in p)&&!("stakes"in p)&&!("category"in p)&&b==="Oddement"||"type"in p&&b==="Fragment"||"stakes"in p&&b==="CampingGear"?!0:"category"in p?p.category.toLowerCase()===b.toLowerCase():!1).filter(p=>{if(!y)return!0;const k=y.toLowerCase(),E=p.name.toLowerCase().includes(k),I=p.description?.toLowerCase().includes(k);return E||I});return t.jsxs(Ke,{className:"h-full",children:[t.jsxs(_e,{className:"shrink-0",children:[t.jsxs("div",{className:"md:flex gap-2",children:[t.jsx(z,{placeholder:"Search by name...",value:y,onChange:p=>g(p.target.value)}),t.jsxs(Rt,{value:b,onValueChange:j,children:[t.jsx(Et,{className:"w-[200px]",children:t.jsx(Tt,{placeholder:"Filter"})}),t.jsxs(At,{children:[t.jsx(X,{value:"all",children:"All"}),t.jsxs(Sn,{children:[t.jsx(Dn,{children:"Backpack"}),t.jsx(X,{value:"Oddement",children:"Oddements"}),t.jsx(X,{value:"Fragment",children:"Fragments"}),t.jsx(X,{value:"CampingGear",children:"Camping Gear"})]}),t.jsxs(Sn,{children:[t.jsx(Dn,{children:"Aspects & Relics"}),t.jsx(X,{value:"Trait",children:"Traits"}),t.jsx(X,{value:"Gear",children:"Gear"}),t.jsx(X,{value:"Habit",children:"Habits"}),t.jsx(X,{value:"Relic",children:"Relics"})]})]})]})]}),e==="self"&&t.jsx(co,{})]}),t.jsx(Dt,{className:"flex-1 min-h-0 p-0",children:t.jsx(Ve,{className:"h-full px-4",children:w.length===0?t.jsx("div",{className:"p-4 text-center text-sm text-zinc-500",children:"No content found"}):t.jsx("div",{className:"space-y-2",children:w.map(p=>t.jsx(lo,{content:p},p.id))})})})]})}function co(){const{openDialog:e}=nt();return t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("p",{children:"Create: "}),t.jsx(D,{size:"sm",onClick:()=>e("oddement"),children:"Oddement"}),t.jsx(D,{size:"sm",onClick:()=>e("fragment"),children:"Fragment"}),t.jsx(D,{size:"sm",onClick:()=>e("camping-gear"),children:"Camping Gear"}),t.jsx(D,{size:"sm",onClick:()=>e("tag"),children:"Tag"}),t.jsx(D,{size:"sm",onClick:()=>e("aspect"),children:"Aspect"})]})}function lo({content:e}){const{attributes:n,listeners:r,setNodeRef:s}=Hs({id:`content-${e.id}`,data:{content:e,type:"content"}});return t.jsxs(Ke,{ref:s,...r,...n,className:"cursor-grab active:cursor-grabbing",children:[t.jsxs(_e,{className:"flex flex-col md:grid",children:[t.jsx(Jt,{children:e.name}),t.jsx(Qt,{children:"category"in e?e.category:"type"in e?`Fragment (${e.type})`:"stakes"in e?"Camping Gear":"Oddement"})]}),t.jsxs(Dt,{children:["image"in e&&e.image&&t.jsx("img",{src:`data:image/png;base64,${e.image}`,alt:e.name,className:"h-32 aspect-square object-cover rounded-md mb-2"}),t.jsx("p",{className:"text-sm text-zinc-600",children:"effect"in e&&e.effect?e.effect:e.description})]})]})}function uo({content:e}){return t.jsxs(Ke,{className:"cursor-grabbing shadow-2xl rotate-3 scale-105 animate-in zoom-in-95 duration-200",children:[t.jsxs(_e,{children:[t.jsx(Jt,{children:e.name}),t.jsx(Qt,{children:"category"in e?e.category:"type"in e?`Fragment (${e.type})`:"stakes"in e?"Camping Gear":"Oddement"})]}),t.jsxs(Dt,{children:["image"in e&&e.image&&t.jsx("img",{src:`data:image/png;base64,${e.image}`,alt:e.name,className:"h-32 aspect-square object-cover rounded-md mb-2"}),t.jsx("p",{className:"text-sm text-zinc-600",children:e.description})]})]})}function ho({children:e,dropAnimation:n}){return t.jsx(oo,{dropAnimation:n,children:e})}function mo({children:e}){const{setNodeRef:n,isOver:r}=ha({id:"sheet-drop-zone"});return t.jsx("div",{ref:n,className:`h-screen relative border-4 ${r?" border-green-400 ring-2 ring-blue-500 ring-offset-2":"border-transparent"}`,children:e})}function fo({children:e}){const{character:n,updateCharacter:r}=B(),[s,o]=d.useState(null),[a,i]=d.useState(null),[c,l]=d.useState(!1),[u,h]=d.useState(1),[m,f]=d.useState(0);function x(g){const{active:N}=g;N.data.current?.type==="content"&&o(N.data.current.content)}function C(g){const{active:N,over:S}=g;if(!S||S.id==="sidebar-drop-zone"){o(null);return}if(S.id==="sheet-drop-zone"){const w=N.data.current?.content;i(w),w&&j(w)?h(1):w&&"maxTrack"in w&&f(w.maxTrack),l(!0)}o(null)}function v(){l(!1),i(null),h(1),f(0)}function b(){if(a){if(j(a)){let g;"type"in a?g="fragments":"stakes"in a?g="campingGear":g="oddements",u>=1e3&&h(1e3);const N="tags"in a&&a.tags?ar(a.id,a.tags):void 0,S=n.data.backpack[g].findIndex(p=>g==="oddements"?p.ref===a.id&&Xt(p.tags,N):p.ref===a.id),w=[...n.data.backpack[g]];if(S!==-1){const p=w[S];w[S]={...p,quantity:p.quantity+u}}else{const p={ref:a.id,quantity:u};g==="oddements"&&N&&(p.tags=N),w.push(p)}r({data:{...n.data,backpack:{...n.data.backpack,[g]:w}}})}if(y(a)){const g=[...n.data.aspects,{ref:a.id,track:m}];r({data:{...n.data,aspects:g}})}me.success(`Added ${a.name} to character`),l(!1),i(null),h(1),f(0)}}function j(g){return"tags"in g||!("type"in g)&&!("category"in g)&&!("stakes"in g)||"type"in g||"stakes"in g&&"effect"in g}function y(g){return"category"in g&&(g.category==="Trait"||g.category==="Gear"||g.category==="Habit"||g.category==="Relic")}return t.jsxs(Vs,{onDragStart:x,onDragEnd:C,children:[t.jsx(mo,{children:e}),t.jsx(ho,{dropAnimation:null,children:s?t.jsx(uo,{content:s}):null}),t.jsx(je,{open:c,onOpenChange:l,children:t.jsxs(Ce,{onInteractOutside:g=>{g.preventDefault()},children:[t.jsxs(ye,{children:[t.jsxs(we,{children:["Add ",a?.name]}),t.jsxs(ke,{children:["Configure the"," ",a&&j(a)?"quantity":"track value"," ","before adding to your character."]})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[a&&j(a)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(Rn,{htmlFor:"quantity",children:"Quantity"}),t.jsx(z,{id:"quantity",type:"number",min:1,value:u||"",onChange:g=>h(parseInt(g.target.value)||1)})]}),a&&y(a)&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs(Rn,{htmlFor:"track",children:["Track (max: ",a.maxTrack,")"]}),t.jsx(z,{id:"track",type:"number",className:"[appearance:textfield]",min:0,max:a.maxTrack,value:m||"",onChange:g=>f(Math.min(parseInt(g.target.value)||0,a.maxTrack))})]})]}),t.jsxs(Ne,{children:[t.jsx(D,{variant:"outline",onClick:v,children:"Cancel"}),t.jsx(D,{onClick:b,children:"Save"})]})]})})]})}function Gn({edgesSkills:e,type:n}){return t.jsxs(yt,{className:"py-2",children:[t.jsxs(wt,{children:[t.jsx(kt,{children:t.jsx("h2",{children:n})}),t.jsx(qn,{children:"(Add 1d6 if appropriate)"})]}),t.jsx(Nt,{className:"md:columns-2 md:gap-4",children:e.map((r,s)=>t.jsx(go,{edgeSkillIndex:s,edgeSkill:r,type:n},r.ref))})]})}function go({type:e,edgeSkill:n,edgeSkillIndex:r}){const{error:s,resolveRefrence:o}=Fe(),{updateCharacter:a,character:i}=B(),c=o(n.ref,e),l=u=>{if(e==="edges"){if(!i?.data?.edges)return;const h=[...i.data.edges];h[r]={...h[r],level:u},a({data:{...i.data,edges:h}})}if(e==="skills"){if(!i?.data?.skills)return;const h=[...i.data.skills];h[r]={...h[r],level:u},a({data:{...i.data,skills:h}})}};return s?t.jsxs("div",{children:["Error: ",s]}):c?t.jsxs("div",{className:"grid grid-cols-[1fr_3fr] md:grid-cols-[2fr_3fr] py-1",children:[t.jsxs(Qe,{children:[t.jsx(Ze,{className:"cursor-help",asChild:!0,children:t.jsx("p",{children:c.name})}),t.jsx(et,{className:"max-w-xs text-center",children:c.description})]}),t.jsx("div",{className:"grow flex justify-center items-center",children:t.jsx(Ye,{maxTrack:c.maxTrack,track:n.level,onChange:l})})]}):t.jsxs("div",{children:["Edge not found: ",n.ref]})}const po=Pa.pick({name:!0,description:!0}),xo={name:"",description:""};function vo({open:e,onOpenChange:n}){const{character:r,updateCharacter:s}=B(),o=Me({defaultValues:xo,validators:{onSubmit:po},onSubmit:async({value:a})=>{const i={id:`${a.name.replace(/[^\w-]+/g,"").toLowerCase()}-${Date.now()}`,name:a.name,description:a.description},c=[...r.data.customOddements||[],i],l=[...r.data?.backpack.oddements||[],{ref:i.id,quantity:1,tags:[]}];s({data:{...r.data,customOddements:c,backpack:{...r.data?.backpack,oddements:l}}}),me.success(`Oddement "${a.name}" created successfully`),o.reset(),n(!1)}});return d.useEffect(()=>{e||o.reset()},[e]),t.jsx(je,{open:e,onOpenChange:n,children:t.jsxs(Ce,{className:"sm:max-w-125",children:[t.jsxs(ye,{children:[t.jsx(we,{children:"Create Custom Item"}),t.jsx(ke,{children:"Add a custom item to your character's Backpack."})]}),t.jsx("form",{id:"oddement-form",onSubmit:a=>{a.preventDefault(),o.handleSubmit()},children:t.jsxs(tt,{children:[t.jsx(o.Field,{name:"name",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Name"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter item name","aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"description",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Description"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter item description (optional)",rows:3,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}})]})}),t.jsxs(Ne,{children:[t.jsx(D,{type:"button",variant:"outline",onClick:()=>{o.reset(),n(!1)},children:"Cancel"}),t.jsx(D,{type:"submit",form:"oddement-form",children:"Create"})]})]})})}const bo=Va.pick({name:!0,description:!0,effect:!0,maxTrack:!0,category:!0}),jo={name:"",description:"",effect:"",maxTrack:1,category:"Trait"};function Co({open:e,onOpenChange:n}){const{character:r,updateCharacter:s}=B(),o=Me({defaultValues:jo,validators:{onSubmit:bo},onSubmit:async({value:a})=>{const i={id:`${a.name.replace(/[^\w-]+/g,"").toLowerCase()}-${Date.now()}`,name:a.name,description:a.description,effect:a.effect,category:a.category,maxTrack:a.maxTrack},c=[...r.data?.customAspects||[],i],l=[...r.data?.aspects||[],{ref:i.id,track:0}];s({data:{...r.data,aspects:l,customAspects:c}}),me.success(`Aspect "${a.name}" created successfully`),o.reset(),n(!1)}});return d.useEffect(()=>{e||o.reset()},[e]),t.jsx(je,{open:e,onOpenChange:n,children:t.jsxs(Ce,{className:"sm:max-w-125",children:[t.jsxs(ye,{children:[t.jsx(we,{children:"Create Custom Aspect"}),t.jsx(ke,{children:"Add a custom aspect to your character."})]}),t.jsx("form",{id:"aspect-form",onSubmit:a=>{a.preventDefault(),o.handleSubmit()},children:t.jsxs(tt,{children:[t.jsx(o.Field,{name:"name",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Name"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter aspect name","aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"category",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Category"}),t.jsxs(Rt,{value:a.state.value,onValueChange:c=>a.handleChange(c),children:[t.jsx(Et,{id:a.name,children:t.jsx(Tt,{})}),t.jsx(At,{children:Ga.options.map(c=>t.jsx(X,{value:c,children:c},c))})]}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"maxTrack",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Max Track"}),t.jsx(z,{id:a.name,name:a.name,type:"number",className:"[appearance:textfield]",min:1,max:10,value:a.state.value||"",onBlur:a.handleBlur,onChange:c=>a.handleChange(Number(c.target.value)),"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"description",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Description"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter aspect description (min 2 characters)",rows:3,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"effect",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Effect"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter aspect effect (min 2 characters)",rows:3,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}})]})}),t.jsxs(Ne,{children:[t.jsx(D,{type:"button",variant:"outline",onClick:()=>{o.reset(),n(!1)},children:"Cancel"}),t.jsx(D,{type:"submit",form:"aspect-form",children:"Create"})]})]})})}const yo=qa.pick({name:!0}).extend({description:Ha()}),wo={name:"",description:""};function ko({open:e,onOpenChange:n}){const{character:r,updateCharacter:s}=B(),o=Me({defaultValues:wo,validators:{onSubmit:yo},onSubmit:async({value:a})=>{const i={id:`${a.name.replace(/[^\w-]+/g,"").toLowerCase()}-${Date.now()}`,name:a.name,description:a.description||void 0},c=[...r.data?.customTags||[],i];s({data:{...r.data,customTags:c}}),me.success(`Tag "${a.name}" created successfully`),o.reset(),n(!1)}});return d.useEffect(()=>{e||o.reset()},[e]),t.jsx(je,{open:e,onOpenChange:n,children:t.jsxs(Ce,{className:"sm:max-w-125",children:[t.jsxs(ye,{children:[t.jsx(we,{children:"Create Custom Tag"}),t.jsx(ke,{children:"Add a custom tag to your character's collection."})]}),t.jsx("form",{id:"tag-form",onSubmit:a=>{a.preventDefault(),o.handleSubmit()},children:t.jsxs(tt,{children:[t.jsx(o.Field,{name:"name",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Name"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter tag name","aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"description",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Description"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter tag description (optional)",rows:3,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}})]})}),t.jsxs(Ne,{children:[t.jsx(D,{type:"button",variant:"outline",onClick:()=>{o.reset(),n(!1)},children:"Cancel"}),t.jsx(D,{type:"submit",form:"tag-form",children:"Create"})]})]})})}const No=Ka.pick({name:!0,description:!0,type:!0}),So={name:"",description:"",type:"Feature"};function Do({open:e,onOpenChange:n}){const{character:r,updateCharacter:s}=B(),o=Me({defaultValues:So,validators:{onSubmit:No},onSubmit:async({value:a})=>{const i={id:`${a.name.replace(/[^\w-]+/g,"").toLowerCase()}-${Date.now()}`,name:a.name,description:a.description,type:a.type},c=[...r.data.customFragments||[],i],l=[...r.data?.backpack.fragments||[],{ref:i.id,quantity:1,tags:[]}];s({data:{...r.data,customFragments:c,backpack:{...r.data?.backpack,fragments:l}}}),me.success(`Fragment "${a.name}" created successfully`),o.reset(),n(!1)}});return d.useEffect(()=>{e||o.reset()},[e]),t.jsx(je,{open:e,onOpenChange:n,children:t.jsxs(Ce,{className:"sm:max-w-125",children:[t.jsxs(ye,{children:[t.jsx(we,{children:"Create Custom Item"}),t.jsx(ke,{children:"Add a custom item to your character's Backpack."})]}),t.jsx("form",{id:"fragment-form",onSubmit:a=>{a.preventDefault(),o.handleSubmit()},children:t.jsxs(tt,{children:[t.jsx(o.Field,{name:"name",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Name"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter item name","aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"type",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Category"}),t.jsxs(Rt,{value:a.state.value,onValueChange:c=>a.handleChange(c),children:[t.jsx(Et,{id:a.name,children:t.jsx(Tt,{})}),t.jsx(At,{children:_a.options.map(c=>t.jsx(X,{value:c,children:c},c))})]}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"description",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Description"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter item description (optional)",rows:3,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}})]})}),t.jsxs(Ne,{children:[t.jsx(D,{type:"button",variant:"outline",onClick:()=>{o.reset(),n(!1)},children:"Cancel"}),t.jsx(D,{type:"submit",form:"fragment-form",children:"Create"})]})]})})}const Ro=Xa.pick({name:!0,description:!0,effect:!0,stakes:!0}),Eo={name:"",description:"",effect:"",stakes:0};function To({open:e,onOpenChange:n}){const{character:r,updateCharacter:s}=B(),o=Me({defaultValues:Eo,validators:{onSubmit:Ro},onSubmit:async({value:a})=>{const i={id:`${a.name.replace(/[^\w-]+/g,"").toLowerCase()}-${Date.now()}`,name:a.name,description:a.description,effect:a.effect,stakes:a.stakes},c=[...r.data.customCampingGear||[],i],l=[...r.data?.backpack.campingGear||[],{ref:i.id,quantity:1,tags:[]}];s({data:{...r.data,customCampingGear:c,backpack:{...r.data?.backpack,campingGear:l}}}),me.success(`Camping Gear "${a.name}" created successfully`),o.reset(),n(!1)}});return d.useEffect(()=>{e||o.reset()},[e]),t.jsx(je,{open:e,onOpenChange:n,children:t.jsxs(Ce,{className:"sm:max-w-125",children:[t.jsxs(ye,{children:[t.jsx(we,{children:"Create Custom Item"}),t.jsx(ke,{children:"Add a custom item to your character's Backpack."})]}),t.jsx("form",{id:"camping-gear-form",onSubmit:a=>{a.preventDefault(),o.handleSubmit()},children:t.jsxs(tt,{children:[t.jsx(o.Field,{name:"name",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Name"}),t.jsx(z,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter item name","aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"description",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Description"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Enter item description (optional)",rows:3,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"effect",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Effect"}),t.jsx(be,{id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:c=>a.handleChange(c.target.value),placeholder:"Describe the effect of this camping gear",rows:4,"aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}}),t.jsx(o.Field,{name:"stakes",children:a=>{const i=a.state.meta.isTouched&&!a.state.meta.isValid;return t.jsxs(T,{"data-invalid":i,children:[t.jsx(A,{htmlFor:a.name,children:"Stakes (0-5)"}),t.jsx(z,{id:a.name,name:a.name,type:"number",className:"[appearance:textfield]",min:0,max:5,value:a.state.value||"",onBlur:a.handleBlur,onChange:c=>a.handleChange(Number(c.target.value)),placeholder:"0","aria-invalid":i}),i&&t.jsx(F,{errors:a.state.meta.errors})]})}})]})}),t.jsxs(Ne,{children:[t.jsx(D,{type:"button",variant:"outline",onClick:()=>{o.reset(),n(!1)},children:"Cancel"}),t.jsx(D,{type:"submit",form:"camping-gear-form",children:"Create"})]})]})})}function Ao({open:e,onOpenChange:n,type:r}){return r==="oddement"?t.jsx(vo,{open:e,onOpenChange:n}):r==="fragment"?t.jsx(Do,{open:e,onOpenChange:n}):r==="camping-gear"?t.jsx(To,{open:e,onOpenChange:n}):r==="aspect"?t.jsx(Co,{open:e,onOpenChange:n}):r==="tag"?t.jsx(ko,{open:e,onOpenChange:n}):null}function $o(){const{characterId:e}=Ya.useParams(),[n,r]=d.useState(!1),{open:s,type:o,closeDialog:a}=nt(),{character:i,loadCharacter:c,error:l,isLoading:u}=B(),{sources:h,loadSources:m,error:f,isLoading:x}=Fe();if(d.useEffect(()=>{(async()=>{if(await c(e),i.data){const j=[i.versionRef,...i.dependencies??[]];me.promise(m(j),{loading:`Loading ${j.length} source(s)...`,success:()=>`Sources loaded: ${j.join(", ")}`,error:y=>`Failed to load sources: ${y instanceof Error?y.message:String(y)}`})}})()},[e,c,m,i.versionRef,i.dependencies]),u||x)return t.jsx("div",{children:"Loading..."});if(l)return t.jsxs("div",{children:["Character Error: ",l]});if(f)return t.jsxs("div",{children:["Source Error: ",f]});if(!i||!i.data)return t.jsx("div",{children:"Character not found"});const v=[i.versionRef,...i.dependencies??[]].filter(b=>!h.has(b));return v.length>0?t.jsxs("div",{children:["Missing source(s): ",v.join(", ")]}):t.jsx(fo,{children:t.jsxs(Ua,{children:[t.jsx(Wa,{to:"/characters",children:t.jsx(D,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:t.jsx(Ja,{})})}),t.jsx(lr,{}),t.jsx(io,{open:n,onOpenChange:r}),t.jsx(Ao,{open:s,onOpenChange:a,type:o}),t.jsx(Ve,{className:`h-[85vh] max-h-[90vh] w-full ${n?"cursor-not-allowed":""}`,children:t.jsxs("div",{className:`flex flex-col gap-4 md:grid md:grid-cols-2 xl:grid-cols-3 ${n?"pointer-events-none":""}`,children:[t.jsxs("div",{className:"md:col-span-1",children:[t.jsxs("div",{className:"pointer-events-none relative",children:[t.jsx("p",{className:"-rotate-45 absolute font-bold text-md backdrop-blur-xs rounded-2xl p-2 -left-4 top-4",children:"Now Digital"}),t.jsx("h1",{children:t.jsx("img",{src:`${Qa}/sheet-logo.png`,className:"p-2",alt:"Eternal Ruins TTRPG logo"})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-around md:flex-col",children:[t.jsx(Gn,{edgesSkills:i.data.edges,type:"edges"}),t.jsx(Gn,{edgesSkills:i.data.skills,type:"skills"})]})]}),t.jsx(vr,{character:i.data.character,className:`md:col-span-1 ${n?"xl:col-span-1 xl:row-start-1":""}`}),t.jsx(xr,{items:i.data.backpack,className:`md:col-span-2 ${n?"xl:col-span-1 xl:row-start-1":"xl:col-span-1"}`}),t.jsx(ir,{aspects:i.data.aspects,className:n?"col-span-2 grid-cols-1 xl:grid-cols-2":"grid-cols-1 md:grid-cols-2 xl:grid-cols-3 md:col-span-2 xl:col-span-3"})]})})]})})}export{$o as component};
