import{u as d,r as m,j as e,A as p,T as u,a as x,b as g,B as t,c as h,d as N,e as S,f as v,g as b,h as F,i as D,k as w,t as c,l as A,m as C,L as y,n as T,S as $,o as U,p as z,q as k,H as E,s as I,v as L,z as B,X as H,w as V}from"./index-C8XPXD6R.js";import{u as M,F as O,a as P,b as J,c as q}from"./useForm-tDaBezUX.js";import{A as G,a as R,b as W,c as X,F as K,d as Q,e as Y,f as Z,g as _,h as ee,i as se}from"./accordion-Dq05Heaz.js";import{T as ae,D as re,F as le}from"./trash-2-91mKILG5.js";import"./chevron-down-COXJbYwy.js";function oe(){const{loadAllSourcesMetadata:a,groupedSources:l}=d(),[o,r]=m.useState(null);return m.useEffect(()=>{a(),fetch("/sources/manifest.json").then(s=>s.json()).then(s=>r(s)).catch(s=>console.error("Failed to load manifest:",s))},[a]),e.jsx(G,{type:"single",collapsible:!0,className:"w-fit",defaultValue:"playtest",children:o?.sources&&o.sources.map(s=>e.jsx(ie,{source:s,groupedSources:l},s.id))})}function ie({source:a,groupedSources:l}){return e.jsxs(R,{value:a.id,children:[e.jsx(W,{className:"pb-2",children:a.id}),e.jsx(X,{className:"pl-4",children:a.versions&&a.versions.map(o=>e.jsx(ne,{sourceId:a.id,version:o,groupedSources:l},o.versionNumber))})]})}function ne({sourceId:a,version:l,groupedSources:o}){const{downloadSource:r,deleteSource:s}=d(),n=[...o.Core,...o.Extra].some(i=>i.id===a&&i.versions.includes(l.versionNumber)),j=async()=>{c.promise(r(a,l.versionNumber,l.filename),{loading:`Downloading ${a}@${l.versionNumber}...`,success:`Successfully downloaded ${a}@${l.versionNumber}`,error:i=>`Failed to download: ${i instanceof Error?i.message:"Unknown error"}`})},f=async()=>{c.promise(s(a,l.versionNumber),{loading:`Deleting ${a}@${l.versionNumber}...`,success:`Successfully deleted ${a}@${l.versionNumber}`,error:i=>`Failed to delete: ${i instanceof Error?i.message:"Unknown error"}`})};return e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsx("p",{children:l.versionNumber}),n?e.jsxs(p,{children:[e.jsxs(u,{children:[e.jsx(x,{asChild:!0,children:e.jsx(g,{asChild:!0,children:e.jsx(t,{size:"icon-sm",variant:"ghost",children:e.jsx(ae,{})})})}),e.jsx(h,{children:"Delete Source"})]}),e.jsxs(N,{children:[e.jsxs(S,{children:[e.jsx(v,{children:"Delete Source"}),e.jsxs(b,{children:["Are you sure you want to delete ",a,"@",l.versionNumber,"? This action cannot be undone."]})]}),e.jsxs(F,{children:[e.jsx(D,{children:"Cancel"}),e.jsx(w,{onClick:f,children:"Delete"})]})]})]}):e.jsxs(u,{children:[e.jsx(x,{asChild:!0,children:e.jsx(t,{size:"icon-sm",variant:"ghost",onClick:j,children:e.jsx(re,{})})}),e.jsx(h,{children:"Download Source"})]})]})}const te=B.instanceof(File,{message:"Please select a file"});function he(){const a=A(),{importSource:l}=d(),o=M({defaultValues:{file:void 0},onSubmit:async({value:r})=>{if(!r.file){c.error("Please select a file");return}c.promise(l(r.file),{loading:"Importing source...",success:s=>(a({to:"/sources/$sourceId/preview",params:{sourceId:s.id}}),`Successfully imported ${s.name}`),error:s=>`Import failed: ${s instanceof Error?s.message:String(s)}`})}});return e.jsxs(C,{children:[e.jsx(y,{to:"/sources",children:e.jsx(t,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:e.jsx(T,{})})}),e.jsxs($,{className:"flex flex-col justify-between",children:[e.jsx(U,{children:e.jsx(z,{children:"Import A Source"})}),e.jsxs(k,{className:"flex flex-col md:flex-row gap-16",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{children:[e.jsx("span",{children:"Download sources from "}),e.jsxs(E,{children:[e.jsx(I,{className:"font-semibold underline cursor-default",children:"Manifest"}),e.jsx(L,{children:"Ports of official rules, and sources containing handy content, or particarly good homebrew."})]})]}),e.jsx(oe,{})]}),e.jsx("form",{id:"import-source",onSubmit:r=>{r.preventDefault(),o.handleSubmit()},className:"flex-1",children:e.jsx(O,{children:e.jsx(o.Field,{name:"file",validators:{onChange:te},children:r=>{const s=r.state.meta.isTouched&&!r.state.meta.isValid;return e.jsxs(P,{"data-invalid":s,children:[e.jsx(J,{children:"Upload JSON File"}),e.jsxs(K,{value:r.state.value?[r.state.value]:[],onValueChange:n=>{r.handleChange(n[0])},accept:".json,application/json",maxFiles:1,onFileValidate:n=>n.name.endsWith(".json")?null:"Only JSON files are allowed",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(le,{className:"size-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Drop your JSON file here, or click to browse"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Only .json files are supported"})]})]})}),e.jsx(Y,{children:r.state.value&&e.jsxs(Z,{value:r.state.value,children:[e.jsx(_,{}),e.jsx(ee,{}),e.jsx(se,{asChild:!0,children:e.jsx(t,{type:"button",size:"icon",variant:"ghost",className:"size-8",children:e.jsx(H,{className:"size-4"})})})]})})]}),s&&e.jsx(q,{errors:r.state.meta.errors})]})}})})})]}),e.jsx(V,{className:"self-end",children:e.jsx(t,{type:"submit",form:"import-source",children:"Import Source"})})]})]})}export{he as component};
