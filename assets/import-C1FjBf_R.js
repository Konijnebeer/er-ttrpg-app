import{C as x,r as j,B as g,j as e,T as d,a as h,d as m,D as u,A as C,b as v,c as o,e as D,f as N,g as F,h as A,i as S,k as b,l as w,t as c,m as y,n as T,L as U,o as z,S as $,p as k,q as B,s as E,H,v as I,w as L,x as M,z as O,X as P,y as V}from"./index-De3IN0Sk.js";import{u as J,F as q,a as R,b as G,c as W}from"./useForm-DAwWR5WT.js";import{A as X,a as _,b as K,c as Q,F as Y,d as Z,e as ee,f as se,g as ae,h as re,i as le}from"./accordion-hESXpCHf.js";import{T as ne,D as ie,F as te}from"./trash-2-jCDJPjhr.js";import"./chevron-down-Bybky4aq.js";function oe(){const{loadAllCharactersMetadata:a,characters:l}=x(),[n,r]=j.useState(null);return j.useEffect(()=>{a(),fetch(`${g}/characters/manifest.json`).then(s=>s.json()).then(s=>r(s)).catch(s=>console.error("Failed to load manifest:",s))},[a]),e.jsx(X,{type:"single",collapsible:!0,className:"w-fit",children:n?.characters&&n.characters.map(s=>e.jsx(ce,{character:s,characters:l},s.id))})}function ce({character:a,characters:l}){return e.jsxs(_,{value:a.id,children:[e.jsx(K,{className:"pb-2",children:a.id}),e.jsx(Q,{className:"pl-4",children:a.versions&&a.versions.map(n=>e.jsx(de,{characterId:a.id,version:n,characters:l},n.versionNumber))})]})}function de({characterId:a,version:l,characters:n}){const{downloadCharacter:r,deleteCharacter:s}=x(),t=n.some(i=>i.id===a),p=async()=>{c.promise(r(a,l.filename),{loading:`Downloading ${a}...`,success:`Successfully downloaded ${a}`,error:i=>`Failed to download: ${i instanceof Error?i.message:"Unknown error"}`})},f=async()=>{c.promise(s(a),{loading:`Deleting ${a}...`,success:`Successfully deleted ${a}`,error:i=>`Failed to delete: ${i instanceof Error?i.message:"Unknown error"}`})};return e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx("p",{children:l.versionNumber})}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx("span",{className:"font-semibold",children:"Core Source: "}),l.versionRef]}),l.dependencies&&l.dependencies.map(i=>e.jsxs(u,{children:[e.jsx("span",{className:"font-semibold",children:"Dependency: "}),i]}))]})]}),t?e.jsxs(C,{children:[e.jsxs(d,{children:[e.jsx(h,{asChild:!0,children:e.jsx(v,{asChild:!0,children:e.jsx(o,{size:"icon-sm",variant:"ghost",children:e.jsx(ne,{})})})}),e.jsx(m,{children:"Delete Character"})]}),e.jsxs(D,{children:[e.jsxs(N,{children:[e.jsx(F,{children:"Delete Character"}),e.jsxs(A,{children:["Are you sure you want to delete ",a,"? This action cannot be undone."]})]}),e.jsxs(S,{children:[e.jsx(b,{children:"Cancel"}),e.jsx(w,{onClick:f,children:"Delete"})]})]})]}):e.jsxs(d,{children:[e.jsx(h,{asChild:!0,children:e.jsx(o,{size:"icon-sm",variant:"ghost",onClick:p,children:e.jsx(ie,{})})}),e.jsx(m,{children:"Download Character"})]})]})}const he=O.instanceof(File,{message:"Please select a file"});function fe(){const a=y(),{importCharacter:l}=x(),n=J({defaultValues:{file:void 0},onSubmit:async({value:r})=>{if(!r.file){c.error("Please select a file");return}c.promise(l(r.file),{loading:"Importing character...",success:s=>(a({to:"/characters/$characterId/preview",params:{characterId:s.id}}),`Successfully imported ${s.name}`),error:s=>`Import failed: ${s instanceof Error?s.message:String(s)}`})}});return e.jsxs(T,{children:[e.jsx(U,{to:"/characters",children:e.jsx(o,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:e.jsx(z,{})})}),e.jsxs($,{className:"flex flex-col justify-between",children:[e.jsx(k,{children:e.jsx(B,{children:"Import A Character"})}),e.jsxs(E,{className:"flex flex-col md:flex-row gap-16",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{children:[e.jsx("span",{children:"Download characters from "}),e.jsxs(H,{children:[e.jsx(I,{className:"font-semibold underline cursor-default",children:"Manifest"}),e.jsx(L,{children:"Pre-made characters to get you started quickly or use as examples."})]})]}),e.jsx(M,{className:"h-[35vh] md:h-[60vh]",children:e.jsx(oe,{})})]}),e.jsx("form",{id:"import-character",onSubmit:r=>{r.preventDefault(),n.handleSubmit()},className:"flex-1",children:e.jsx(q,{children:e.jsx(n.Field,{name:"file",validators:{onChange:he},children:r=>{const s=r.state.meta.isTouched&&!r.state.meta.isValid;return e.jsxs(R,{"data-invalid":s,children:[e.jsx(G,{children:"Upload JSON File"}),e.jsxs(Y,{value:r.state.value?[r.state.value]:[],onValueChange:t=>{r.handleChange(t[0])},accept:".json,application/json",maxFiles:1,onFileValidate:t=>t.name.endsWith(".json")?null:"Only JSON files are allowed",children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(te,{className:"size-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Drop your JSON file here, or click to browse"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Only .json files are supported"})]})]})}),e.jsx(ee,{children:r.state.value&&e.jsxs(se,{value:r.state.value,children:[e.jsx(ae,{}),e.jsx(re,{}),e.jsx(le,{asChild:!0,children:e.jsx(o,{type:"button",size:"icon",variant:"ghost",className:"size-8",children:e.jsx(P,{className:"size-4"})})})]})})]}),s&&e.jsx(W,{errors:r.state.meta.errors})]})}})})})]}),e.jsx(V,{className:"self-end ",children:e.jsx(o,{type:"submit",form:"import-character",children:"Import Character"})})]})]})}export{fe as component};
