import{u as d,r as m,B as p,j as e,A as g,T as u,a as x,b as N,c as t,d as h,e as S,f as v,g as b,h as F,i as D,k as A,l as w,t as c,m as C,n as y,L as T,o as $,S as U,p as z,q as E,s as k,H as B,v as H,w as I,z as L,X as V,x as M}from"./index-NJlMi6EM.js";import{u as O,F as P,a as J,b as q,c as G}from"./useForm-Pf7n5Y8a.js";import{A as R,a as W,b as X,c as _,F as K,d as Q,e as Y,f as Z,g as ee,h as se,i as ae}from"./accordion-BH828ids.js";import{T as re,D as le,F as oe}from"./trash-2-x-BjCTsr.js";import"./chevron-down-CKPHfNxV.js";function ie(){const{loadAllSourcesMetadata:a,groupedSources:l}=d(),[o,r]=m.useState(null);return m.useEffect(()=>{a(),fetch(`${p}/sources/manifest.json`).then(s=>s.json()).then(s=>r(s)).catch(s=>console.error("Failed to load manifest:",s))},[a]),e.jsx(R,{type:"single",collapsible:!0,className:"w-fit",defaultValue:"playtest",children:o?.sources&&o.sources.map(s=>e.jsx(ne,{source:s,groupedSources:l},s.id))})}function ne({source:a,groupedSources:l}){return e.jsxs(W,{value:a.id,children:[e.jsx(X,{className:"pb-2",children:a.id}),e.jsx(_,{className:"pl-4",children:a.versions&&a.versions.map(o=>e.jsx(te,{sourceId:a.id,version:o,groupedSources:l},o.versionNumber))})]})}function te({sourceId:a,version:l,groupedSources:o}){const{downloadSource:r,deleteSource:s}=d(),n=[...o.Core,...o.Extra].some(i=>i.id===a&&i.versions.includes(l.versionNumber)),j=async()=>{c.promise(r(a,l.versionNumber,l.filename),{loading:`Downloading ${a}@${l.versionNumber}...`,success:`Successfully downloaded ${a}@${l.versionNumber}`,error:i=>`Failed to download: ${i instanceof Error?i.message:"Unknown error"}`})},f=async()=>{c.promise(s(a,l.versionNumber),{loading:`Deleting ${a}@${l.versionNumber}...`,success:`Successfully deleted ${a}@${l.versionNumber}`,error:i=>`Failed to delete: ${i instanceof Error?i.message:"Unknown error"}`})};return e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsx("p",{children:l.versionNumber}),n?e.jsxs(g,{children:[e.jsxs(u,{children:[e.jsx(x,{asChild:!0,children:e.jsx(N,{asChild:!0,children:e.jsx(t,{size:"icon-sm",variant:"ghost",children:e.jsx(re,{})})})}),e.jsx(h,{children:"Delete Source"})]}),e.jsxs(S,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"Delete Source"}),e.jsxs(F,{children:["Are you sure you want to delete ",a,"@",l.versionNumber,"? This action cannot be undone."]})]}),e.jsxs(D,{children:[e.jsx(A,{children:"Cancel"}),e.jsx(w,{onClick:f,children:"Delete"})]})]})]}):e.jsxs(u,{children:[e.jsx(x,{asChild:!0,children:e.jsx(t,{size:"icon-sm",variant:"ghost",onClick:j,children:e.jsx(le,{})})}),e.jsx(h,{children:"Download Source"})]})]})}const ce=L.instanceof(File,{message:"Please select a file"});function je(){const a=C(),{importSource:l}=d(),o=O({defaultValues:{file:void 0},onSubmit:async({value:r})=>{if(!r.file){c.error("Please select a file");return}c.promise(l(r.file),{loading:"Importing source...",success:s=>(a({to:"/sources/$sourceId/preview",params:{sourceId:s.id}}),`Successfully imported ${s.name}`),error:s=>`Import failed: ${s instanceof Error?s.message:String(s)}`})}});return e.jsxs(y,{children:[e.jsx(T,{to:"/sources",children:e.jsx(t,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:e.jsx($,{})})}),e.jsxs(U,{className:"flex flex-col justify-between",children:[e.jsx(z,{children:e.jsx(E,{children:"Import A Source"})}),e.jsxs(k,{className:"flex flex-col md:flex-row gap-16",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{children:[e.jsx("span",{children:"Download sources from "}),e.jsxs(B,{children:[e.jsx(H,{className:"font-semibold underline cursor-default",children:"Manifest"}),e.jsx(I,{children:"Ports of official rules, and sources containing handy content, or particarly good homebrew."})]})]}),e.jsx(ie,{})]}),e.jsx("form",{id:"import-source",onSubmit:r=>{r.preventDefault(),o.handleSubmit()},className:"flex-1",children:e.jsx(P,{children:e.jsx(o.Field,{name:"file",validators:{onChange:ce},children:r=>{const s=r.state.meta.isTouched&&!r.state.meta.isValid;return e.jsxs(J,{"data-invalid":s,children:[e.jsx(q,{children:"Upload JSON File"}),e.jsxs(K,{value:r.state.value?[r.state.value]:[],onValueChange:n=>{r.handleChange(n[0])},accept:".json,application/json",maxFiles:1,onFileValidate:n=>n.name.endsWith(".json")?null:"Only JSON files are allowed",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(oe,{className:"size-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Drop your JSON file here, or click to browse"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Only .json files are supported"})]})]})}),e.jsx(Y,{children:r.state.value&&e.jsxs(Z,{value:r.state.value,children:[e.jsx(ee,{}),e.jsx(se,{}),e.jsx(ae,{asChild:!0,children:e.jsx(t,{type:"button",size:"icon",variant:"ghost",className:"size-8",children:e.jsx(V,{className:"size-4"})})})]})})]}),s&&e.jsx(G,{errors:r.state.meta.errors})]})}})})})]}),e.jsx(M,{className:"self-end",children:e.jsx(t,{type:"submit",form:"import-source",children:"Import Source"})})]})]})}export{je as component};
