import{x,r as j,j as e,T as d,a as h,c as m,y as u,A as g,b as C,B as o,d as v,e as D,f as F,g as N,h as b,i as w,k as A,t as c,l as S,m as y,L as T,n as U,S as z,o as k,p as $,q as B,H as E,s as I,v as L,z as H,X as M,w as O}from"./index-BvppboyF.js";import{u as V,F as P,a as J,b as q,c as R}from"./useForm-nf2enZWr.js";import{A as G,a as W,b as X,c as K,F as Q,d as Y,e as Z,f as _,g as ee,h as se,i as ae}from"./accordion-QN-oWk6F.js";import{T as re,D as le,F as ne}from"./trash-2-DO6FUMcA.js";import"./chevron-down-DBj0Q3cI.js";function te(){const{loadAllCharactersMetadata:a,characters:l}=x(),[n,r]=j.useState(null);return j.useEffect(()=>{a(),fetch("/characters/manifest.json").then(s=>s.json()).then(s=>r(s)).catch(s=>console.error("Failed to load manifest:",s))},[a]),e.jsx(G,{type:"single",collapsible:!0,className:"w-fit",children:n?.characters&&n.characters.map(s=>e.jsx(ie,{character:s,characters:l},s.id))})}function ie({character:a,characters:l}){return e.jsxs(W,{value:a.id,children:[e.jsx(X,{className:"pb-2",children:a.id}),e.jsx(K,{className:"pl-4",children:a.versions&&a.versions.map(n=>e.jsx(oe,{characterId:a.id,version:n,characters:l},n.versionNumber))})]})}function oe({characterId:a,version:l,characters:n}){const{downloadCharacter:r,deleteCharacter:s}=x(),i=n.some(t=>t.id===a),p=async()=>{c.promise(r(a,l.filename),{loading:`Downloading ${a}...`,success:`Successfully downloaded ${a}`,error:t=>`Failed to download: ${t instanceof Error?t.message:"Unknown error"}`})},f=async()=>{c.promise(s(a),{loading:`Deleting ${a}...`,success:`Successfully deleted ${a}`,error:t=>`Failed to delete: ${t instanceof Error?t.message:"Unknown error"}`})};return e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx("p",{children:l.versionNumber})}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx("span",{className:"font-semibold",children:"Core Source: "}),l.versionRef]}),l.dependencies&&l.dependencies.map(t=>e.jsxs(u,{children:[e.jsx("span",{className:"font-semibold",children:"Dependency: "}),t]}))]})]}),i?e.jsxs(g,{children:[e.jsxs(d,{children:[e.jsx(h,{asChild:!0,children:e.jsx(C,{asChild:!0,children:e.jsx(o,{size:"icon-sm",variant:"ghost",children:e.jsx(re,{})})})}),e.jsx(m,{children:"Delete Character"})]}),e.jsxs(v,{children:[e.jsxs(D,{children:[e.jsx(F,{children:"Delete Character"}),e.jsxs(N,{children:["Are you sure you want to delete ",a,"? This action cannot be undone."]})]}),e.jsxs(b,{children:[e.jsx(w,{children:"Cancel"}),e.jsx(A,{onClick:f,children:"Delete"})]})]})]}):e.jsxs(d,{children:[e.jsx(h,{asChild:!0,children:e.jsx(o,{size:"icon-sm",variant:"ghost",onClick:p,children:e.jsx(le,{})})}),e.jsx(m,{children:"Download Character"})]})]})}const ce=H.instanceof(File,{message:"Please select a file"});function ue(){const a=S(),{importCharacter:l}=x(),n=V({defaultValues:{file:void 0},onSubmit:async({value:r})=>{if(!r.file){c.error("Please select a file");return}c.promise(l(r.file),{loading:"Importing character...",success:s=>(a({to:"/characters/$characterId/preview",params:{characterId:s.id}}),`Successfully imported ${s.name}`),error:s=>`Import failed: ${s instanceof Error?s.message:String(s)}`})}});return e.jsxs(y,{children:[e.jsx(T,{to:"/characters",children:e.jsx(o,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:e.jsx(U,{})})}),e.jsxs(z,{className:"flex flex-col justify-between",children:[e.jsx(k,{children:e.jsx($,{children:"Import A Character"})}),e.jsxs(B,{className:"flex flex-col md:flex-row gap-16",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{children:[e.jsx("span",{children:"Download characters from "}),e.jsxs(E,{children:[e.jsx(I,{className:"font-semibold underline cursor-default",children:"Manifest"}),e.jsx(L,{children:"Pre-made characters to get you started quickly or use as examples."})]})]}),e.jsx(te,{})]}),e.jsx("form",{id:"import-character",onSubmit:r=>{r.preventDefault(),n.handleSubmit()},className:"flex-1",children:e.jsx(P,{children:e.jsx(n.Field,{name:"file",validators:{onChange:ce},children:r=>{const s=r.state.meta.isTouched&&!r.state.meta.isValid;return e.jsxs(J,{"data-invalid":s,children:[e.jsx(q,{children:"Upload JSON File"}),e.jsxs(Q,{value:r.state.value?[r.state.value]:[],onValueChange:i=>{r.handleChange(i[0])},accept:".json,application/json",maxFiles:1,onFileValidate:i=>i.name.endsWith(".json")?null:"Only JSON files are allowed",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ne,{className:"size-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Drop your JSON file here, or click to browse"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Only .json files are supported"})]})]})}),e.jsx(Z,{children:r.state.value&&e.jsxs(_,{value:r.state.value,children:[e.jsx(ee,{}),e.jsx(se,{}),e.jsx(ae,{asChild:!0,children:e.jsx(o,{type:"button",size:"icon",variant:"ghost",className:"size-8",children:e.jsx(M,{className:"size-4"})})})]})})]}),s&&e.jsx(R,{errors:r.state.meta.errors})]})}})})})]}),e.jsx(O,{className:"self-end ",children:e.jsx(o,{type:"submit",form:"import-character",children:"Import Character"})})]})]})}export{ue as component};
