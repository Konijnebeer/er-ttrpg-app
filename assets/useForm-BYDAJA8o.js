import{r as w,j as F,b3 as xt,G as P,V as Ot,I as Rt,R,O as pt,aY as gt,U as C}from"./index-CGdY7LBB.js";var Bt="Label",At=w.forwardRef((e,r)=>F.jsx(xt.label,{...e,ref:r,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));At.displayName=Bt;var Pt=At;function $t({className:e,...r}){return F.jsx(Pt,{"data-slot":"label",className:P("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...r})}function he({className:e,...r}){return F.jsx("fieldset",{"data-slot":"field-set",className:P("flex flex-col gap-6","has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3",e),...r})}function fe({className:e,...r}){return F.jsx("div",{"data-slot":"field-group",className:P("group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4",e),...r})}const jt=Ot("group/field flex w-full gap-3 data-[invalid=true]:text-destructive",{variants:{orientation:{vertical:["flex-col [&>*]:w-full [&>.sr-only]:w-auto"],horizontal:["flex-row items-center","[&>[data-slot=field-label]]:flex-auto","has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px"],responsive:["flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto","@md/field-group:[&>[data-slot=field-label]]:flex-auto","@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px"]}},defaultVariants:{orientation:"vertical"}});function me({className:e,orientation:r="vertical",...s}){return F.jsx("div",{role:"group","data-slot":"field","data-orientation":r,className:P(jt({orientation:r}),e),...s})}function ve({className:e,...r}){return F.jsx($t,{"data-slot":"field-label",className:P("group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50","has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4","has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10",e),...r})}function pe({className:e,...r}){return F.jsx("p",{"data-slot":"field-description",className:P("text-muted-foreground text-sm leading-normal font-normal group-has-[[data-orientation=horizontal]]/field:text-balance","last:mt-0 nth-last-2:-mt-1 [[data-variant=legend]+&]:-mt-1.5","[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",e),...r})}function ge({className:e,children:r,errors:s,...t}){const i=w.useMemo(()=>{if(r)return r;if(!s?.length)return null;const a=[...new Map(s.map(n=>[n?.message,n])).values()];return a?.length==1?a[0]?.message:F.jsx("ul",{className:"ml-4 flex list-disc flex-col gap-1",children:a.map((n,u)=>n?.message&&F.jsx("li",{children:n.message},u))})},[r,s]);return i?F.jsx("div",{role:"alert","data-slot":"field-error",className:P("text-destructive text-sm font-normal",e),...t,children:i}):null}function Me(e){const r=e+"CollectionProvider",[s,t]=Rt(r),[i,a]=s(r,{collectionRef:{current:null},itemMap:new Map}),n=p=>{const{scope:g,children:v}=p,M=R.useRef(null),b=R.useRef(new Map).current;return F.jsx(i,{scope:g,itemMap:b,collectionRef:M,children:v})};n.displayName=r;const u=e+"CollectionSlot",d=gt(u),o=R.forwardRef((p,g)=>{const{scope:v,children:M}=p,b=a(u,v),S=pt(g,b.collectionRef);return F.jsx(d,{ref:S,children:M})});o.displayName=u;const l=e+"CollectionItemSlot",c="data-radix-collection-item",h=gt(l),f=R.forwardRef((p,g)=>{const{scope:v,children:M,...b}=p,S=R.useRef(null),V=pt(g,S),A=a(l,v);return R.useEffect(()=>(A.itemMap.set(S,{ref:S,...b}),()=>void A.itemMap.delete(S))),F.jsx(h,{[c]:"",ref:V,children:M})});f.displayName=l;function m(p){const g=a(e+"CollectionConsumer",p);return R.useCallback(()=>{const M=g.collectionRef.current;if(!M)return[];const b=Array.from(M.querySelectorAll(`[${c}]`));return Array.from(g.itemMap.values()).sort((A,T)=>b.indexOf(A.ref.current)-b.indexOf(T.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:n,Slot:o,ItemSlot:f},m,t]}const N=new WeakMap,Z=new WeakMap,st={current:[]};let ut=!1,K=0;const G=new Set,z=new Map;function It(e){const r=Array.from(e).sort((s,t)=>s instanceof _&&s.options.deps.includes(t)?1:t instanceof _&&t.options.deps.includes(s)?-1:0);for(const s of r){if(st.current.includes(s))continue;st.current.push(s),s.recompute();const t=Z.get(s);if(t)for(const i of t){const a=N.get(i);a&&It(a)}}}function Nt(e){const r={prevVal:e.prevState,currentVal:e.state};for(const s of e.listeners)s(r)}function Ut(e){const r={prevVal:e.prevState,currentVal:e.state};for(const s of e.listeners)s(r)}function Lt(e){if(K>0&&!z.has(e)&&z.set(e,e.prevState),G.add(e),!(K>0)&&!ut)try{for(ut=!0;G.size>0;){const r=Array.from(G);G.clear();for(const s of r){const t=z.get(s)??s.prevState;s.prevState=t,Nt(s)}for(const s of r){const t=N.get(s);t&&(st.current.push(s),It(t))}for(const s of r){const t=N.get(s);if(t)for(const i of t)Ut(i)}}}finally{ut=!1,st.current=[],z.clear()}}function D(e){K++;try{e()}finally{if(K--,K===0){const r=G.values().next().value;r&&Lt(r)}}}function Wt(e){return typeof e=="function"}class it{constructor(r,s){this.listeners=new Set,this.subscribe=t=>{var i,a;this.listeners.add(t);const n=(a=(i=this.options)==null?void 0:i.onSubscribe)==null?void 0:a.call(i,t,this);return()=>{this.listeners.delete(t),n?.()}},this.prevState=r,this.state=r,this.options=s}setState(r){var s,t,i;this.prevState=this.state,(s=this.options)!=null&&s.updateFn?this.state=this.options.updateFn(this.prevState)(r):Wt(r)?this.state=r(this.prevState):this.state=r,(i=(t=this.options)==null?void 0:t.onUpdate)==null||i.call(t),Lt(this)}}class _{constructor(r){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const s=this.options.deps.length,t=new Array(s),i=new Array(s);for(let a=0;a<s;a++){const n=this.options.deps[a];t[a]=n.prevState,i[a]=n.state}return this.lastSeenDepValues=i,{prevDepVals:t,currDepVals:i,prevVal:this.prevState??void 0}},this.recompute=()=>{var s,t;this.prevState=this.state;const i=this.getDepVals();this.state=this.options.fn(i),(t=(s=this.options).onUpdate)==null||t.call(s)},this.checkIfRecalculationNeededDeeply=()=>{for(const a of this.options.deps)a instanceof _&&a.checkIfRecalculationNeededDeeply();let s=!1;const t=this.lastSeenDepValues,{currDepVals:i}=this.getDepVals();for(let a=0;a<i.length;a++)if(i[a]!==t[a]){s=!0;break}s&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const s of this._subscriptions)s()}),this.subscribe=s=>{var t,i;this.listeners.add(s);const a=(i=(t=this.options).onSubscribe)==null?void 0:i.call(t,s,this);return()=>{this.listeners.delete(s),a?.()}},this.options=r,this.state=r.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(r=this.options.deps){for(const s of r)if(s instanceof _)s.registerOnGraph(),this.registerOnGraph(s.options.deps);else if(s instanceof it){let t=N.get(s);t||(t=new Set,N.set(s,t)),t.add(this);let i=Z.get(this);i||(i=new Set,Z.set(this,i)),i.add(s)}}unregisterFromGraph(r=this.options.deps){for(const s of r)if(s instanceof _)this.unregisterFromGraph(s.options.deps);else if(s instanceof it){const t=N.get(s);t&&t.delete(this);const i=Z.get(this);i&&i.delete(s)}}}function Gt(e){return typeof e=="function"}function Mt(e,...r){return Gt(e)?e(...r):e}function Kt(e){return e||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}class Tt{#s=!0;#t;#e;#a;#i;#r;#n;#l;#d=0;#h=5;#o=!1;#c=()=>{this.debugLog("Connected to event bus"),this.#r=!0,this.#o=!1,this.debugLog("Emitting queued events",this.#i),this.#i.forEach(r=>this.emitEventToBus(r)),this.#i=[],this.stopConnectLoop(),this.#e().removeEventListener("tanstack-connect-success",this.#c)};#u=()=>{if(this.#d<this.#h){this.#d++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#e().removeEventListener("tanstack-connect",this.#u),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#f=()=>{this.#o||(this.#o=!0,this.#e().addEventListener("tanstack-connect-success",this.#c),this.#u())};constructor({pluginId:r,debug:s=!1,enabled:t=!0,reconnectEveryMs:i=300}){this.#t=r,this.#s=t,this.#e=this.getGlobalTarget,this.#a=s,this.debugLog(" Initializing event subscription for plugin",this.#t),this.#i=[],this.#r=!1,this.#n=null,this.#l=i}startConnectLoop(){this.#n!==null||this.#r||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#n=setInterval(this.#u,this.#l))}stopConnectLoop(){this.#o=!1,this.#n!==null&&(clearInterval(this.#n),this.#n=null,this.debugLog("Stopped connect loop"))}debugLog(...r){this.#a&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#t}-plugin]`,...r)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const r=typeof EventTarget<"u"?new EventTarget:void 0;return typeof r>"u"||typeof r.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),r)}getPluginId(){return this.#t}dispatchCustomEventShim(r,s){try{const t=new Event(r,{detail:s});this.#e().dispatchEvent(t)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(r,s){try{this.#e().dispatchEvent(new CustomEvent(r,{detail:s}))}catch{this.dispatchCustomEventShim(r,s)}}emitEventToBus(r){this.debugLog("Emitting event to client bus",r),this.dispatchCustomEvent("tanstack-dispatch-event",r)}emit(r,s){if(!this.#s){this.debugLog("Event bus client is disabled, not emitting event",r,s);return}if(!this.#r){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#i.push({type:`${this.#t}:${r}`,payload:s,pluginId:this.#t}),typeof CustomEvent<"u"&&!this.#o&&(this.#f(),this.startConnectLoop());return}return this.emitEventToBus({type:`${this.#t}:${r}`,payload:s,pluginId:this.#t})}on(r,s){const t=`${this.#t}:${r}`;if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event",t),()=>{};const i=a=>{this.debugLog("Received event from bus",a.detail),s(a.detail)};return this.#e().addEventListener(t,i),this.debugLog("Registered event to bus",t),()=>{this.#e().removeEventListener(t,i)}}onAll(r){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const s=t=>{const i=t.detail;r(i)};return this.#e().addEventListener("tanstack-devtools-global",s),()=>this.#e().removeEventListener("tanstack-devtools-global",s)}onAllPluginEvents(r){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const s=t=>{const i=t.detail;this.#t&&i.pluginId!==this.#t||r(i)};return this.#e().addEventListener("tanstack-devtools-global",s),()=>this.#e().removeEventListener("tanstack-devtools-global",s)}}class zt extends Tt{constructor(r){super({pluginId:"pacer",debug:r?.debug})}}const qt=(e,r)=>{Dt.emit(e,r)},Dt=new zt;function bt(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}const Ht={enabled:!0,leading:!0,trailing:!0,wait:0};class Xt{constructor(r,s){this.fn=r,this.store=new it(bt()),this.setOptions=t=>{this.options={...this.options,...t},this.#e()||this.cancel()},this.#t=t=>{this.store.setState(i=>{const a={...i,...t},{isPending:n}=a;return{...a,status:this.#e()?n?"pending":"idle":"disabled"}}),qt("Throttler",this)},this.#e=()=>!!Mt(this.options.enabled,this),this.#a=()=>Mt(this.options.wait,this),this.maybeExecute=(...t)=>{this.#t({maybeExecuteCount:this.store.state.maybeExecuteCount+1});const i=Date.now(),a=i-this.store.state.lastExecutionTime,n=this.#a();if(this.options.leading&&a>=n)this.#i(...t);else if(this.#t({lastArgs:t}),!this.#s&&this.options.trailing){const u=this.store.state.lastExecutionTime?i-this.store.state.lastExecutionTime:0,d=n-u;this.#t({isPending:!0}),this.#s=setTimeout(()=>{const{lastArgs:o}=this.store.state;o!==void 0&&this.#i(...o)},d)}},this.#i=(...t)=>{if(!this.#e())return;this.fn(...t);const i=Date.now(),a=i+this.#a();this.#r(),this.#t({executionCount:this.store.state.executionCount+1,lastExecutionTime:i,nextExecutionTime:a,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(t,this),setTimeout(()=>{this.store.state.isPending||this.#t({nextExecutionTime:void 0})},this.#a())},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&this.#i(...this.store.state.lastArgs)},this.#r=()=>{this.#s&&(clearTimeout(this.#s),this.#s=void 0)},this.cancel=()=>{this.#r(),this.#t({lastArgs:void 0,isPending:!1})},this.reset=()=>{this.#t(bt())},this.key=Kt(s.key),this.options={...Ht,...s},this.#t(this.options.initialState??{}),Dt.on("d-Throttler",t=>{t.payload.key===this.key&&(this.#t(t.payload.store.state),this.setOptions(t.payload.options))})}#s;#t;#e;#a;#i;#r}function Yt(e,r){return new Xt(e,r).maybeExecute}function nt(e,r){return typeof e=="function"?e(r):e}function q(e,r){return vt(r).reduce((t,i)=>{if(t===null)return null;if(typeof t<"u")return t[i]},e)}function H(e,r,s){const t=vt(r);function i(a){if(!t.length)return nt(s,a);const n=t.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(a))return typeof a=="object"?(a===null&&(a={}),{...a,[n]:i(a[n])}):{[n]:i()};if(Array.isArray(a)&&typeof n=="number"){const u=a.slice(0,n);return[...u.length?u:new Array(n),i(a[n]),...a.slice(n+1)]}return[...new Array(n),i()]}return i(e)}function Jt(e,r){const s=vt(r);function t(i){if(!i)return;if(s.length===1){const n=s[0];if(Array.isArray(i)&&typeof n=="number")return i.filter((o,l)=>l!==n);const{[n]:u,...d}=i;return d}const a=s.shift();if((typeof a=="string"||typeof a=="number"&&!Array.isArray(i))&&typeof i=="object")return{...i,[a]:t(i[a])};if(typeof a=="number"&&Array.isArray(i)){if(a>=i.length)return i;const n=i.slice(0,a);return[...n.length?n:new Array(a),t(i[a]),...i.slice(a+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(e)}const Qt=/^(\d+)$/gm,Zt=/\.(\d+)(?=\.)/gm,te=/^(\d+)\./gm,ee=/\.(\d+$)/gm,se=/\.{2,}/gm,ct="__int__",X=`${ct}$1`;function vt(e){if(Array.isArray(e))return[...e];if(typeof e!="string")throw new Error("Path must be a string.");return e.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(Qt,X).replace(Zt,`.${X}.`).replace(te,`${X}.`).replace(ee,`.${X}`).replace(se,".").split(".").map(r=>{if(r.startsWith(ct)){const s=r.substring(ct.length),t=parseInt(s,10);return String(t)===s?t:s}return r})}function be(e,r){return e.length===0?r:r.length===0?e:r.startsWith("[")||r.startsWith(".")?e+r:`${e}.${r}`}function ie(e){return!(Array.isArray(e)&&e.length===0)}function ht(e,r){const s=t=>t.validators.filter(Boolean).map(i=>({cause:i.cause,validate:i.fn}));return r.validationLogic({form:r.form,validators:r.validators,event:{type:e,async:!1},runValidation:s})}function ft(e,r){const{asyncDebounceMs:s}=r,{onBlurAsyncDebounceMs:t,onChangeAsyncDebounceMs:i,onDynamicAsyncDebounceMs:a}=r.validators||{},n=s??0,u=d=>d.validators.filter(Boolean).map(o=>{const l=o?.cause||e;let c=n;switch(l){case"change":c=i??n;break;case"blur":c=t??n;break;case"dynamic":c=a??n;break;case"submit":c=0;break}return e==="submit"&&(c=0),{cause:l,validate:o.fn,debounceMs:c}});return r.validationLogic({form:r.form,validators:r.validators,event:{type:e,async:!0},runValidation:u})}const mt=e=>!!e&&typeof e=="object"&&"fields"in e;function x(e,r){if(Object.is(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;if(e instanceof Date&&r instanceof Date)return e.getTime()===r.getTime();if(e instanceof Map&&r instanceof Map){if(e.size!==r.size)return!1;for(const[i,a]of e)if(!r.has(i)||!Object.is(a,r.get(i)))return!1;return!0}if(e instanceof Set&&r instanceof Set){if(e.size!==r.size)return!1;for(const i of e)if(!r.has(i))return!1;return!0}const s=Object.keys(e),t=Object.keys(r);if(s.length!==t.length)return!1;for(const i of s)if(!t.includes(i)||!x(e[i],r[i]))return!1;return!0}const yt=({newFormValidatorError:e,isPreviousErrorFromFormValidator:r,previousErrorValue:s})=>e?{newErrorValue:e,newSource:"form"}:r?{newErrorValue:void 0,newSource:void 0}:s?{newErrorValue:s,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},St=({formLevelError:e,fieldLevelError:r})=>r?{newErrorValue:r,newSource:"field"}:e?{newErrorValue:e,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function E(e,r){return e==null?r:{...e,...r}}let B=256;const tt=[];let Y;for(;B--;)tt[B]=(B+256).toString(16).substring(1);function Ct(){let e=0,r,s="";if(!Y||B+16>256){for(Y=new Array(256),e=256;e--;)Y[e]=256*Math.random()|0;e=0,B=0}for(;e<16;e++)r=Y[B+e],e===6?s+=tt[r&15|64]:e===8?s+=tt[r&63|128]:s+=tt[r],e&1&&e>1&&e<11&&(s+="-");return B++,s}const j=e=>{if(!e.validators)return e.runValidation({validators:[],form:e.form});const r=e.event.async,s=r?void 0:{fn:e.validators.onMount,cause:"mount"},t={fn:r?e.validators.onChangeAsync:e.validators.onChange,cause:"change"},i={fn:r?e.validators.onBlurAsync:e.validators.onBlur,cause:"blur"},a={fn:r?e.validators.onSubmitAsync:e.validators.onSubmit,cause:"submit"},n=r?void 0:{fn:()=>{},cause:"server"};switch(e.event.type){case"mount":return e.runValidation({validators:[s],form:e.form});case"submit":return e.runValidation({validators:[t,i,a,n],form:e.form});case"server":return e.runValidation({validators:[],form:e.form});case"blur":return e.runValidation({validators:[i,n],form:e.form});case"change":return e.runValidation({validators:[t,n],form:e.form});default:throw new Error(`Unknown validation event type: ${e.event.type}`)}};function re(e,r){const s=new Map;for(const t of e){const i=t.path??[];let a=r,n="";for(let u=0;u<i.length;u++){const d=i[u];if(d===void 0)continue;const o=typeof d=="object"?d.key:d,l=Number(o);Array.isArray(a)&&!Number.isNaN(l)?n+=`[${l}]`:n+=(u>0?".":"")+String(o),typeof a=="object"&&a!==null?a=a[o]:a=void 0}s.set(n,(s.get(n)??[]).concat(t))}return Object.fromEntries(s)}const Vt=(e,r)=>{const s=re(e,r);return{form:s,fields:s}},U={validate({value:e,validationSource:r},s){const t=s["~standard"].validate(e);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return r==="field"?t.issues:Vt(t.issues,e)},async validateAsync({value:e,validationSource:r},s){const t=await s["~standard"].validate(e);if(t.issues)return r==="field"?t.issues:Vt(t.issues,e)}},_t=e=>!!e&&"~standard"in e,rt={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function J(e){function r(l,c,h){const f=n(l,c,"move",h),m=Math.min(c,h),p=Math.max(c,h);for(let v=m;v<=p;v++)f.push(a(l,v));const g=Object.keys(e.fieldInfo).reduce((v,M)=>(M.startsWith(a(l,c))&&v.set(M,e.getFieldMeta(M)),v),new Map);d(f,c<h?"up":"down"),Object.keys(e.fieldInfo).filter(v=>v.startsWith(a(l,h))).forEach(v=>{const M=v.replace(a(l,h),a(l,c)),b=g.get(M);b&&e.setFieldMeta(v,b)})}function s(l,c){const h=n(l,c,"remove");d(h,"up")}function t(l,c,h){n(l,c,"swap",h).forEach(m=>{if(!m.toString().startsWith(a(l,c)))return;const p=m.toString().replace(a(l,c),a(l,h)),[g,v]=[e.getFieldMeta(m),e.getFieldMeta(p)];g&&e.setFieldMeta(p,g),v&&e.setFieldMeta(m,v)})}function i(l,c){const h=n(l,c,"insert");d(h,"down"),h.forEach(f=>{f.toString().startsWith(a(l,c))&&e.setFieldMeta(f,o())})}function a(l,c){return`${l}[${c}]`}function n(l,c,h,f){const m=[a(l,c)];switch(h){case"swap":m.push(a(l,f));break;case"move":{const[p,g]=[Math.min(c,f),Math.max(c,f)];for(let v=p;v<=g;v++)m.push(a(l,v));break}default:{const p=e.getFieldValue(l),g=Array.isArray(p)?p.length:0;for(let v=c+1;v<g;v++)m.push(a(l,v));break}}return Object.keys(e.fieldInfo).filter(p=>m.some(g=>p.startsWith(g)))}function u(l,c){return l.replace(/\[(\d+)\]/,(h,f)=>{const m=parseInt(f,10);return`[${c==="up"?m+1:Math.max(0,m-1)}]`})}function d(l,c){(c==="up"?l:[...l].reverse()).forEach(f=>{const m=u(f.toString(),c),p=e.getFieldMeta(m);p?e.setFieldMeta(f,p):e.setFieldMeta(f,o())})}const o=()=>rt;return{handleArrayMove:r,handleArrayRemove:s,handleArraySwap:t,handleArrayInsert:i}}class ae extends Tt{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const L=new ae;function dt(e){return{values:e.values??{},errorMap:e.errorMap??{},fieldMetaBase:e.fieldMetaBase??{},isSubmitted:e.isSubmitted??!1,isSubmitting:e.isSubmitting??!1,isValidating:e.isValidating??!1,submissionAttempts:e.submissionAttempts??0,isSubmitSuccessful:e.isSubmitSuccessful??!1,validationMetaMap:e.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class Ft{constructor(r){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const t=this.fieldMetaDerived.mount(),i=this.store.mount(),a=()=>{t(),i(),L.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:n}=this.options.validators||{};return L.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),n&&this.validateSync("mount"),a},this.update=t=>{if(!t)return;const i=this.options;this.options=t;const a=!!t.transform?.deps?.some((d,o)=>d!==this.prevTransformArray[o]),n=t.defaultValues&&!x(t.defaultValues,i.defaultValues)&&!this.state.isTouched,u=!x(t.defaultState,i.defaultState)&&!this.state.isTouched;!n&&!u&&!a||(D(()=>{this.baseStore.setState(()=>dt(Object.assign({},this.state,u?t.defaultState:{},n?{values:t.defaultValues}:{},a?{_force_re_eval:!this.state._force_re_eval}:{})))}),L.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(t,i)=>{const{fieldMeta:a}=this.state,n=this.resetFieldMeta(a);t&&!i?.keepDefaultValues&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>dt({...this.options.defaultState,values:t??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:n}))},this.validateAllFields=async t=>{const i=[];return D(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const u=n.instance;i.push(Promise.resolve().then(()=>u.validate(t,{skipFormValidation:!0}))),n.instance.state.meta.isTouched||n.instance.setMeta(d=>({...d,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(t,i,a)=>{const n=this.getFieldValue(t),u=Array.isArray(n)?Math.max(n.length-1,0):null,d=[`${t}[${i}]`];for(let h=i+1;h<=(u??0);h++)d.push(`${t}[${h}]`);const o=Object.keys(this.fieldInfo).filter(h=>d.some(f=>h.startsWith(f))),l=[];return D(()=>{o.forEach(h=>{l.push(Promise.resolve().then(()=>this.validateField(h,a)))})}),(await Promise.all(l)).flat()},this.validateField=(t,i)=>{const a=this.fieldInfo[t]?.instance;return a?(a.state.meta.isTouched||a.setMeta(n=>({...n,isTouched:!0})),a.validate(i)):[]},this.validateSync=t=>{const i=ht(t,{...this.options,form:this,validationLogic:this.options.validationLogic||j});let a=!1;const n={};return D(()=>{for(const o of i){if(!o.validate)continue;const l=this.runValidator({validate:o.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:c,fieldErrors:h}=et(l),f=W(o.cause);for(const m of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[m]===void 0)continue;const p=this.getFieldMeta(m);if(!p)continue;const{errorMap:g,errorSourceMap:v}=p,M=h?.[m],{newErrorValue:b,newSource:S}=yt({newFormValidatorError:M,isPreviousErrorFromFormValidator:v?.[f]==="form",previousErrorValue:g?.[f]});S==="form"&&(n[m]={...n[m],[f]:M}),g?.[f]!==b&&this.setFieldMeta(m,V=>({...V,errorMap:{...V.errorMap,[f]:b},errorSourceMap:{...V.errorSourceMap,[f]:S}}))}this.state.errorMap?.[f]!==c&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[f]:c}})),(c||h)&&(a=!0)}const u=W("submit");this.state.errorMap?.[u]&&t!=="submit"&&!a&&this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[u]:void 0}}));const d=W("server");this.state.errorMap?.[d]&&t!=="server"&&!a&&this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[d]:void 0}}))}),{hasErrored:a,fieldsErrorMap:n}},this.validateAsync=async t=>{const i=ft(t,{...this.options,form:this,validationLogic:this.options.validationLogic||j});this.state.isFormValidating||this.baseStore.setState(o=>({...o,isFormValidating:!0}));const a=[];let n;for(const o of i){if(!o.validate)continue;const l=W(o.cause);this.state.validationMetaMap[l]?.lastAbortController.abort();const h=new AbortController;this.state.validationMetaMap[l]={lastAbortController:h},a.push(new Promise(async f=>{let m;try{m=await new Promise((M,b)=>{setTimeout(async()=>{if(h.signal.aborted)return M(void 0);try{M(await this.runValidator({validate:o.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:h.signal},type:"validateAsync"}))}catch(S){b(S)}},o.debounceMs)})}catch(M){m=M}const{formError:p,fieldErrors:g}=et(m);g&&(n=n?{...n,...g}:g);const v=W(o.cause);for(const M of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[M]===void 0)continue;const b=this.getFieldMeta(M);if(!b)continue;const{errorMap:S,errorSourceMap:V}=b,A=n?.[M],{newErrorValue:T,newSource:I}=yt({newFormValidatorError:A,isPreviousErrorFromFormValidator:V?.[v]==="form",previousErrorValue:S?.[v]});S?.[v]!==T&&this.setFieldMeta(M,k=>({...k,errorMap:{...k.errorMap,[v]:T},errorSourceMap:{...k.errorSourceMap,[v]:I}}))}this.baseStore.setState(M=>({...M,errorMap:{...M.errorMap,[v]:p}})),f(n?{fieldErrors:n,errorMapKey:v}:void 0)}))}let u=[];const d={};if(a.length){u=await Promise.all(a);for(const o of u)if(o?.fieldErrors){const{errorMapKey:l}=o;for(const[c,h]of Object.entries(o.fieldErrors)){const m={...d[c]||{},[l]:h};d[c]=m}}}return this.baseStore.setState(o=>({...o,isFormValidating:!1})),d},this.validate=t=>{const{hasErrored:i,fieldsErrorMap:a}=this.validateSync(t);return i&&!this.options.asyncAlways?a:this.validateAsync(t)},this._handleSubmit=async t=>{this.baseStore.setState(n=>({...n,isSubmitted:!1,submissionAttempts:n.submissionAttempts+1,isSubmitSuccessful:!1})),D(()=>{Object.values(this.fieldInfo).forEach(n=>{n.instance&&(n.instance.state.meta.isTouched||n.instance.setMeta(u=>({...u,isTouched:!0})))})});const i=t??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:i});return}this.baseStore.setState(n=>({...n,isSubmitting:!0}));const a=()=>{this.baseStore.setState(n=>({...n,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){a(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:i}),L.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(n=>n.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){a(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:i}),L.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}D(()=>{Object.values(this.fieldInfo).forEach(n=>{n.instance?.options.listeners?.onSubmit?.({value:n.instance.state.value,fieldApi:n.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:i});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:i}),D(()=>{this.baseStore.setState(n=>({...n,isSubmitted:!0,isSubmitSuccessful:!0})),L.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),a()})}catch(n){throw this.baseStore.setState(u=>({...u,isSubmitSuccessful:!1})),L.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:n}),a(),n}},this.getFieldValue=t=>q(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>this.fieldInfo[t]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(t,i)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[t]:nt(i,a.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((i,a)=>{const n=a;return i[n]=rt,i},{}),this.setFieldValue=(t,i,a)=>{const n=a?.dontUpdateMeta??!1,u=a?.dontRunListeners??!1,d=a?.dontValidate??!1;D(()=>{n||this.setFieldMeta(t,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o?.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:H(o.values,t,i)}))}),u||this.getFieldInfo(t).instance?.triggerOnChangeListener(),d||this.validateField(t,"change")},this.deleteField=t=>{const a=[...Object.keys(this.fieldInfo).filter(n=>{const u=t.toString();return n!==u&&n.startsWith(u)}),t];this.baseStore.setState(n=>{const u={...n};return a.forEach(d=>{u.values=Jt(u.values,d),delete this.fieldInfo[d],delete u.fieldMetaBase[d]}),u})},this.pushFieldValue=(t,i,a)=>{this.setFieldValue(t,n=>[...Array.isArray(n)?n:[],i],a)},this.insertFieldValue=async(t,i,a,n)=>{this.setFieldValue(t,d=>[...d.slice(0,i),a,...d.slice(i)],E(n,{dontValidate:!0}));const u=n?.dontValidate??!1;u||await this.validateField(t,"change"),J(this).handleArrayInsert(t,i),u||await this.validateArrayFieldsStartingFrom(t,i,"change")},this.replaceFieldValue=async(t,i,a,n)=>{this.setFieldValue(t,d=>d.map((o,l)=>l===i?a:o),E(n,{dontValidate:!0})),(n?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,i,"change"))},this.removeFieldValue=async(t,i,a)=>{const n=this.getFieldValue(t),u=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(t,o=>o.filter((l,c)=>c!==i),E(a,{dontValidate:!0})),J(this).handleArrayRemove(t,i),u!==null){const o=`${t}[${u}]`;this.deleteField(o)}(a?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,i,"change"))},this.swapFieldValues=(t,i,a,n)=>{this.setFieldValue(t,d=>{const o=d[i],l=d[a];return H(H(d,`${i}`,l),`${a}`,o)},E(n,{dontValidate:!0})),J(this).handleArraySwap(t,i,a),(n?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${i}]`,"change"),this.validateField(`${t}[${a}]`,"change"))},this.moveFieldValues=(t,i,a,n)=>{this.setFieldValue(t,d=>{const o=[...d];return o.splice(a,0,o.splice(i,1)[0]),o},E(n,{dontValidate:!0})),J(this).handleArrayMove(t,i,a),(n?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${i}]`,"change"),this.validateField(`${t}[${a}]`,"change"))},this.clearFieldValues=(t,i)=>{const a=this.getFieldValue(t),n=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(t,[],E(i,{dontValidate:!0})),n!==null)for(let d=0;d<=n;d++){const o=`${t}[${d}]`;this.deleteField(o)}(i?.dontValidate??!1)||this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[t]:rt},values:this.options.defaultValues?H(i.values,t,q(this.options.defaultValues,t)):i.values}))},this.setErrorMap=t=>{D(()=>{Object.entries(t).forEach(([i,a])=>{const n=i;if(mt(a)){const{formError:u,fieldErrors:d}=et(a);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,c=>({...c,errorMap:{...c.errorMap,[n]:d?.[o]},errorSourceMap:{...c.errorSourceMap,[n]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[n]:u}}))}else this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[n]:a}}))})})},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[i,a])=>(Object.keys(a).length&&a.errors.length&&(t[i]={errors:a.errors,errorMap:a.errorMap}),t),{})}),this.parseValuesWithSchema=t=>U.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>U.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=r?.formId??Ct(),this._devtoolsSubmissionOverride=!1,this.baseStore=new it(dt({...r?.defaultState,values:r?.defaultValues??r?.defaultState?.values})),this.fieldMetaDerived=new _({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:i,prevVal:a})=>{const n=a,u=t?.[0],d=i[0];let o=0;const l={};for(const c of Object.keys(d.fieldMetaBase)){const h=d.fieldMetaBase[c],f=u?.fieldMetaBase[c],m=n?.[c],p=q(d.values,c);let g=m?.errors;if(!f||h.errorMap!==f.errorMap){g=Object.values(h.errorMap??{}).filter(V=>V!==void 0);const S=this.getFieldInfo(c)?.instance;S&&!S.options.disableErrorFlat&&(g=g.flat(1))}const v=!ie(g),M=!h.isDirty,b=x(p,q(this.options.defaultValues,c))||x(p,this.getFieldInfo(c)?.instance?.options.defaultValue);if(m&&m.isPristine===M&&m.isValid===v&&m.isDefaultValue===b&&m.errors===g&&h===f){l[c]=m,o++;continue}l[c]={...h,errors:g??[],isPristine:M,isValid:v,isDefaultValue:b}}return Object.keys(d.fieldMetaBase).length&&n&&o===Object.keys(d.fieldMetaBase).length?n:l}}),this.store=new _({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:i,prevVal:a})=>{const n=a,u=t?.[0],d=i[0],o=i[1],l=Object.values(o).filter(Boolean),c=l.some(y=>y.isValidating),h=l.every(y=>y.isValid),f=l.some(y=>y.isTouched),m=l.some(y=>y.isBlurred),p=l.every(y=>y.isDefaultValue),g=f&&d.errorMap?.onMount,v=l.some(y=>y.isDirty),M=!v,b=!!(d.errorMap?.onMount||l.some(y=>y?.errorMap?.onMount)),S=!!c;let V=n?.errors??[];(!u||d.errorMap!==u.errorMap)&&(V=Object.values(d.errorMap).reduce((y,O)=>O===void 0?y:O&&mt(O)?(y.push(O.form),y):(y.push(O),y),[]));const A=V.length===0,T=h&&A,I=this.options.canSubmitWhenInvalid??!1,k=d.submissionAttempts===0&&!f&&!b||!S&&!d.isSubmitting&&T||I;let $=d.errorMap;if(g&&(V=V.filter(y=>y!==d.errorMap.onMount),$=Object.assign($,{onMount:void 0})),n&&u&&n.errorMap===$&&n.fieldMeta===this.fieldMetaDerived.state&&n.errors===V&&n.isFieldsValidating===c&&n.isFieldsValid===h&&n.isFormValid===A&&n.isValid===T&&n.canSubmit===k&&n.isTouched===f&&n.isBlurred===m&&n.isPristine===M&&n.isDefaultValue===p&&n.isDirty===v&&x(u,d))return n;let ot={...d,errorMap:$,fieldMeta:this.fieldMetaDerived.state,errors:V,isFieldsValidating:c,isFieldsValid:h,isFormValid:A,isValid:T,canSubmit:k,isTouched:f,isBlurred:m,isPristine:M,isDefaultValue:p,isDirty:v};const lt=this.options.transform?.deps??[];if(lt.length!==this.prevTransformArray.length||lt.some((y,O)=>y!==this.prevTransformArray[O])){const y=Object.assign({},this,{state:ot});this.options.transform?.fn(y),ot=y.state,this.prevTransformArray=lt}return ot}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(r||{});const s=Yt(t=>L.emit("form-state",{id:this._formId,state:t}),{wait:300});this.store.subscribe(()=>{s(this.store.state)}),L.on("request-form-state",t=>{t.payload.id===this._formId&&L.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),L.on("request-form-reset",t=>{t.payload.id===this._formId&&this.reset()}),L.on("request-form-force-submit",t=>{t.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(r){return _t(r.validate)?U[r.type](r.value,r.validate):r.validate(r.value)}handleSubmit(r){return this._handleSubmit(r)}}function et(e){if(e){if(mt(e)){const r=et(e.form).formError,s=e.fields;return{formError:r,fieldErrors:s}}return{formError:e}}return{formError:void 0}}function W(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class Et{constructor(r){this.options={},this.mount=()=>{const s=this.store.mount();this.options.defaultValue!==void 0&&!this.getMeta().isTouched&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:i}=this.options.validators||{};if(i){const a=this.runValidator({validate:i,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});a&&this.setMeta(n=>({...n,errorMap:{...n?.errorMap,onMount:a},errorSourceMap:{...n?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),s},this.update=s=>{if(this.options=s,this.name=s.name,!this.state.meta.isTouched&&this.options.defaultValue!==void 0){const t=this.form.getFieldValue(this.name);x(t,s.defaultValue)||this.form.setFieldValue(this.name,s.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})}this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(s,t)=>{this.form.setFieldValue(this.name,s,E(t,{dontRunListeners:!0,dontValidate:!0})),t?.dontRunListeners||this.triggerOnChangeListener(),t?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=s=>this.form.setFieldMeta(this.name,s),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(s,t)=>{this.form.pushFieldValue(this.name,s,E(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(s,t,i)=>{this.form.insertFieldValue(this.name,s,t,E(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(s,t,i)=>{this.form.replaceFieldValue(this.name,s,t,E(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(s,t)=>{this.form.removeFieldValue(this.name,s,E(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(s,t,i)=>{this.form.swapFieldValues(this.name,s,t,E(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(s,t,i)=>{this.form.moveFieldValues(this.name,s,t,E(i,{dontRunListeners:!0})),i?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=s=>{this.form.clearFieldValues(this.name,E(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=s=>{const t=Object.values(this.form.fieldInfo),i=[];for(const a of t){if(!a.instance)continue;const{onChangeListenTo:n,onBlurListenTo:u}=a.instance.options.validators||{};s==="change"&&n?.includes(this.name)&&i.push(a.instance),s==="blur"&&u?.includes(this.name)&&i.push(a.instance)}return i},this.validateSync=(s,t)=>{const i=ht(s,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||j}),n=this.getLinkedFields(s).reduce((o,l)=>{const c=ht(s,{...l.options,form:l.form,validationLogic:l.form.options.validationLogic||j});return c.forEach(h=>{h.field=l}),o.concat(c)},[]);let u=!1;D(()=>{const o=(l,c)=>{const h=Q(c.cause),f=c.validate?wt(l.runValidator({validate:c.validate,value:{value:l.store.state.value,validationSource:"field",fieldApi:l},type:"validate"})):void 0,m=t[h],{newErrorValue:p,newSource:g}=St({formLevelError:m,fieldLevelError:f});l.state.meta.errorMap?.[h]!==p&&l.setMeta(v=>({...v,errorMap:{...v.errorMap,[h]:p},errorSourceMap:{...v.errorSourceMap,[h]:g}})),p&&(u=!0)};for(const l of i)o(this,l);for(const l of n)l.validate&&o(l.field,l)});const d=Q("submit");return this.state.meta.errorMap?.[d]&&s!=="submit"&&!u&&this.setMeta(o=>({...o,errorMap:{...o.errorMap,[d]:void 0},errorSourceMap:{...o.errorSourceMap,[d]:void 0}})),{hasErrored:u}},this.validateAsync=async(s,t)=>{const i=ft(s,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||j}),a=await t,n=this.getLinkedFields(s),u=n.reduce((h,f)=>{const m=ft(s,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||j});return m.forEach(p=>{p.field=f}),h.concat(m)},[]);this.state.meta.isValidating||this.setMeta(h=>({...h,isValidating:!0}));for(const h of n)h.setMeta(f=>({...f,isValidating:!0}));const d=[],o=[],l=(h,f,m)=>{const p=Q(f.cause);h.getInfo().validationMetaMap[p]?.lastAbortController.abort();const v=new AbortController;this.getInfo().validationMetaMap[p]={lastAbortController:v},m.push(new Promise(async M=>{let b;try{b=await new Promise((I,k)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(v.signal.aborted)return I(void 0);try{I(await this.runValidator({validate:f.validate,value:{value:h.store.state.value,fieldApi:h,signal:v.signal,validationSource:"field"},type:"validateAsync"}))}catch($){k($)}},f.debounceMs)})}catch(I){b=I}if(v.signal.aborted)return M(void 0);const S=wt(b),V=a[this.name]?.[p],{newErrorValue:A,newSource:T}=St({formLevelError:V,fieldLevelError:S});h.setMeta(I=>({...I,errorMap:{...I?.errorMap,[p]:A},errorSourceMap:{...I.errorSourceMap,[p]:T}})),M(A)}))};for(const h of i)h.validate&&l(this,h,d);for(const h of u)h.validate&&l(h.field,h,o);let c=[];(d.length||o.length)&&(c=await Promise.all(d),await Promise.all(o)),this.setMeta(h=>({...h,isValidating:!1}));for(const h of n)h.setMeta(f=>({...f,isValidating:!1}));return c.filter(Boolean)},this.validate=(s,t)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:i}=t?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(s),{hasErrored:a}=this.validateSync(s,i[this.name]??{});if(a&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[Q(s)]?.lastAbortController.abort(),this.state.meta.errors;const n=t?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(s);return this.validateAsync(s,n)},this.handleChange=s=>{this.setValue(s)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.setErrorMap=s=>{this.setMeta(t=>({...t,errorMap:{...t.errorMap,...s}}))},this.parseValueWithSchema=s=>U.validate({value:this.state.value,validationSource:"field"},s),this.parseValueWithSchemaAsync=s=>U.validateAsync({value:this.state.value,validationSource:"field"},s),this.triggerOnChangeListener=()=>{const s=this.form.options.listeners?.onChangeDebounceMs;s&&s>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},s)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const t=this.options.listeners?.onChangeDebounceMs;t&&t>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},t)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},this.form=r.form,this.name=r.name,this.options=r,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new _({deps:[this.form.store],fn:()=>{const s=this.form.getFieldMeta(this.name)??{...rt,...r.defaultMeta};let t=this.form.getFieldValue(this.name);return!s.isTouched&&t===void 0&&this.options.defaultValue!==void 0&&!x(t,this.options.defaultValue)&&(t=this.options.defaultValue),{value:t,meta:s}}})}get state(){return this.store.state}runValidator(r){return _t(r.validate)?U[r.type](r.value,r.validate):r.validate(r.value)}triggerOnBlurListener(){const r=this.form.options.listeners?.onBlurDebounceMs;r&&r>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},r)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const s=this.options.listeners?.onBlurDebounceMs;s&&s>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},s)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}}function wt(e){if(e)return e}function Q(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}const at=typeof window<"u"?w.useLayoutEffect:w.useEffect;function ne(e){const[r,s]=w.useState(()=>({form:e.form,name:e.name})),[t,i]=w.useState(()=>new Et({...e}));(r.form!==e.form||r.name!==e.name)&&(i(new Et({...e})),s({form:e.form,name:e.name}));const a=C(t.store,f=>f.value),n=C(t.store,f=>f.meta.isTouched),u=C(t.store,f=>f.meta.isBlurred),d=C(t.store,f=>f.meta.isDirty),o=C(t.store,f=>f.meta.errorMap),l=C(t.store,f=>f.meta.errorSourceMap),c=C(t.store,f=>f.meta.isValidating),h=w.useMemo(()=>{const m={...t,get state(){return{value:a,get meta(){return{...t.state.meta,isTouched:n,isBlurred:u,isDirty:d,errorMap:o,errorSourceMap:l,isValidating:c}}}}};return m.Field=kt,m},[t,a,n,u,d,o,l,c]);return at(t.mount,[t]),at(()=>{t.update(e)}),C(t.store,e.mode==="array"?f=>[f.meta,Object.keys(f.value??[]).length]:void 0),h}const kt=(({children:e,...r})=>{const s=ne(r),t=w.useMemo(()=>nt(e,s),[e,s]);return F.jsx(F.Fragment,{children:t})});function oe(){return w.useState(()=>Ct())[0]}const le=w.version.split(".")[0]==="17"?oe:w.useId;function ue({form:e,selector:r,children:s}){const t=C(e.store,r);return F.jsx(F.Fragment,{children:nt(s,t)})}function ye(e){const r=le(),[s,t]=w.useState(e?.formId),[i,a]=w.useState(()=>new Ft({...e,formId:e?.formId??r}));if(s!==e?.formId){const u=e?.formId??r;a(new Ft({...e,formId:u})),t(u)}const n=w.useMemo(()=>{const u={...i,handleSubmit:((...d)=>i._handleSubmit(...d)),get formId(){return i._formId},get state(){return i.store.state}};return u.Field=function(o){return F.jsx(kt,{...o,form:i})},u.Subscribe=function(o){return F.jsx(ue,{form:i,selector:o.selector,children:o.children})},u},[i]);return at(i.mount,[]),at(()=>{i.update(e)}),n}export{_ as D,fe as F,$t as L,me as a,ve as b,ge as c,Me as d,be as e,at as f,q as g,nt as h,he as i,pe as j,vt as m,ye as u};
