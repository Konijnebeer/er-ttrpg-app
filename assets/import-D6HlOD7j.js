import{y as x,r as j,B as g,j as e,T as d,a as h,d as m,C as u,A as C,b as v,c as o,e as D,f as F,g as N,h as A,i as b,k as S,l as w,t as c,m as y,n as T,L as U,o as z,S as $,p as k,q as B,s as E,H,v as I,w as L,z as M,X as O,x as P}from"./index-NJlMi6EM.js";import{u as V,F as J,a as q,b as R,c as G}from"./useForm-Pf7n5Y8a.js";import{A as W,a as X,b as _,c as K,F as Q,d as Y,e as Z,f as ee,g as se,h as ae,i as re}from"./accordion-BH828ids.js";import{T as le,D as ne,F as te}from"./trash-2-x-BjCTsr.js";import"./chevron-down-CKPHfNxV.js";function ie(){const{loadAllCharactersMetadata:a,characters:l}=x(),[n,r]=j.useState(null);return j.useEffect(()=>{a(),fetch(`${g}/characters/manifest.json`).then(s=>s.json()).then(s=>r(s)).catch(s=>console.error("Failed to load manifest:",s))},[a]),e.jsx(W,{type:"single",collapsible:!0,className:"w-fit",children:n?.characters&&n.characters.map(s=>e.jsx(oe,{character:s,characters:l},s.id))})}function oe({character:a,characters:l}){return e.jsxs(X,{value:a.id,children:[e.jsx(_,{className:"pb-2",children:a.id}),e.jsx(K,{className:"pl-4",children:a.versions&&a.versions.map(n=>e.jsx(ce,{characterId:a.id,version:n,characters:l},n.versionNumber))})]})}function ce({characterId:a,version:l,characters:n}){const{downloadCharacter:r,deleteCharacter:s}=x(),i=n.some(t=>t.id===a),p=async()=>{c.promise(r(a,l.filename),{loading:`Downloading ${a}...`,success:`Successfully downloaded ${a}`,error:t=>`Failed to download: ${t instanceof Error?t.message:"Unknown error"}`})},f=async()=>{c.promise(s(a),{loading:`Deleting ${a}...`,success:`Successfully deleted ${a}`,error:t=>`Failed to delete: ${t instanceof Error?t.message:"Unknown error"}`})};return e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx("p",{children:l.versionNumber})}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx("span",{className:"font-semibold",children:"Core Source: "}),l.versionRef]}),l.dependencies&&l.dependencies.map(t=>e.jsxs(u,{children:[e.jsx("span",{className:"font-semibold",children:"Dependency: "}),t]}))]})]}),i?e.jsxs(C,{children:[e.jsxs(d,{children:[e.jsx(h,{asChild:!0,children:e.jsx(v,{asChild:!0,children:e.jsx(o,{size:"icon-sm",variant:"ghost",children:e.jsx(le,{})})})}),e.jsx(m,{children:"Delete Character"})]}),e.jsxs(D,{children:[e.jsxs(F,{children:[e.jsx(N,{children:"Delete Character"}),e.jsxs(A,{children:["Are you sure you want to delete ",a,"? This action cannot be undone."]})]}),e.jsxs(b,{children:[e.jsx(S,{children:"Cancel"}),e.jsx(w,{onClick:f,children:"Delete"})]})]})]}):e.jsxs(d,{children:[e.jsx(h,{asChild:!0,children:e.jsx(o,{size:"icon-sm",variant:"ghost",onClick:p,children:e.jsx(ne,{})})}),e.jsx(m,{children:"Download Character"})]})]})}const de=M.instanceof(File,{message:"Please select a file"});function pe(){const a=y(),{importCharacter:l}=x(),n=V({defaultValues:{file:void 0},onSubmit:async({value:r})=>{if(!r.file){c.error("Please select a file");return}c.promise(l(r.file),{loading:"Importing character...",success:s=>(a({to:"/characters/$characterId/preview",params:{characterId:s.id}}),`Successfully imported ${s.name}`),error:s=>`Import failed: ${s instanceof Error?s.message:String(s)}`})}});return e.jsxs(T,{children:[e.jsx(U,{to:"/characters",children:e.jsx(o,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:e.jsx(z,{})})}),e.jsxs($,{className:"flex flex-col justify-between",children:[e.jsx(k,{children:e.jsx(B,{children:"Import A Character"})}),e.jsxs(E,{className:"flex flex-col md:flex-row gap-16",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{children:[e.jsx("span",{children:"Download characters from "}),e.jsxs(H,{children:[e.jsx(I,{className:"font-semibold underline cursor-default",children:"Manifest"}),e.jsx(L,{children:"Pre-made characters to get you started quickly or use as examples."})]})]}),e.jsx(ie,{})]}),e.jsx("form",{id:"import-character",onSubmit:r=>{r.preventDefault(),n.handleSubmit()},className:"flex-1",children:e.jsx(J,{children:e.jsx(n.Field,{name:"file",validators:{onChange:de},children:r=>{const s=r.state.meta.isTouched&&!r.state.meta.isValid;return e.jsxs(q,{"data-invalid":s,children:[e.jsx(R,{children:"Upload JSON File"}),e.jsxs(Q,{value:r.state.value?[r.state.value]:[],onValueChange:i=>{r.handleChange(i[0])},accept:".json,application/json",maxFiles:1,onFileValidate:i=>i.name.endsWith(".json")?null:"Only JSON files are allowed",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(te,{className:"size-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Drop your JSON file here, or click to browse"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Only .json files are supported"})]})]})}),e.jsx(Z,{children:r.state.value&&e.jsxs(ee,{value:r.state.value,children:[e.jsx(se,{}),e.jsx(ae,{}),e.jsx(re,{asChild:!0,children:e.jsx(o,{type:"button",size:"icon",variant:"ghost",className:"size-8",children:e.jsx(O,{className:"size-4"})})})]})})]}),s&&e.jsx(G,{errors:r.state.meta.errors})]})}})})})]}),e.jsx(P,{className:"self-end ",children:e.jsx(o,{type:"submit",form:"import-character",children:"Import Character"})})]})]})}export{pe as component};
