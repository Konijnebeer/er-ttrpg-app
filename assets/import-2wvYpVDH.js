import{u as d,r as m,B as p,j as e,A as g,T as u,a as x,b as N,c as t,d as h,e as S,f as v,g as b,h as F,i as D,k as A,l as w,t as c,m as C,n as y,L as T,o as $,S as U,p as z,q as E,s as k,H as B,v as H,w as I,x as L,z as V,X as M,y as O}from"./index-QXhXNQW-.js";import{u as P,F as J,a as q,b as G,c as R}from"./useForm-4AbIf3Bq.js";import{A as W,a as X,b as _,c as K,F as Q,d as Y,e as Z,f as ee,g as se,h as ae,i as re}from"./accordion-D8tK7-xq.js";import{T as le,D as oe,F as ie}from"./trash-2-uIHwitZF.js";import"./chevron-down-OjeGunuP.js";function ne(){const{loadAllSourcesMetadata:a,groupedSources:l}=d(),[o,r]=m.useState(null);return m.useEffect(()=>{a(),fetch(`${p}/sources/manifest.json`).then(s=>s.json()).then(s=>r(s)).catch(s=>console.error("Failed to load manifest:",s))},[a]),e.jsx(W,{type:"single",collapsible:!0,className:"w-fit",defaultValue:"playtest",children:o?.sources&&o.sources.map(s=>e.jsx(te,{source:s,groupedSources:l},s.id))})}function te({source:a,groupedSources:l}){return e.jsxs(X,{value:a.id,children:[e.jsx(_,{className:"pb-2",children:a.id}),e.jsx(K,{className:"pl-4",children:a.versions&&a.versions.map(o=>e.jsx(ce,{sourceId:a.id,version:o,groupedSources:l},o.versionNumber))})]})}function ce({sourceId:a,version:l,groupedSources:o}){const{downloadSource:r,deleteSource:s}=d(),n=[...o.Core,...o.Extra].some(i=>i.id===a&&i.versions.includes(l.versionNumber)),j=async()=>{c.promise(r(a,l.versionNumber,l.filename),{loading:`Downloading ${a}@${l.versionNumber}...`,success:`Successfully downloaded ${a}@${l.versionNumber}`,error:i=>`Failed to download: ${i instanceof Error?i.message:"Unknown error"}`})},f=async()=>{c.promise(s(a,l.versionNumber),{loading:`Deleting ${a}@${l.versionNumber}...`,success:`Successfully deleted ${a}@${l.versionNumber}`,error:i=>`Failed to delete: ${i instanceof Error?i.message:"Unknown error"}`})};return e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsx("p",{children:l.versionNumber}),n?e.jsxs(g,{children:[e.jsxs(u,{children:[e.jsx(x,{asChild:!0,children:e.jsx(N,{asChild:!0,children:e.jsx(t,{size:"icon-sm",variant:"ghost",children:e.jsx(le,{})})})}),e.jsx(h,{children:"Delete Source"})]}),e.jsxs(S,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"Delete Source"}),e.jsxs(F,{children:["Are you sure you want to delete ",a,"@",l.versionNumber,"? This action cannot be undone."]})]}),e.jsxs(D,{children:[e.jsx(A,{children:"Cancel"}),e.jsx(w,{onClick:f,children:"Delete"})]})]})]}):e.jsxs(u,{children:[e.jsx(x,{asChild:!0,children:e.jsx(t,{size:"icon-sm",variant:"ghost",onClick:j,children:e.jsx(oe,{})})}),e.jsx(h,{children:"Download Source"})]})]})}const de=V.instanceof(File,{message:"Please select a file"});function fe(){const a=C(),{importSource:l}=d(),o=P({defaultValues:{file:void 0},onSubmit:async({value:r})=>{if(!r.file){c.error("Please select a file");return}c.promise(l(r.file),{loading:"Importing source...",success:s=>(a({to:"/sources/$sourceId/preview",params:{sourceId:s.id}}),`Successfully imported ${s.name}`),error:s=>`Import failed: ${s instanceof Error?s.message:String(s)}`})}});return e.jsxs(y,{children:[e.jsx(T,{to:"/sources",children:e.jsx(t,{size:"icon",className:"fixed left-5 top-5 z-50","aria-label":"Back to previous page",children:e.jsx($,{})})}),e.jsxs(U,{className:"flex flex-col justify-between",children:[e.jsx(z,{children:e.jsx(E,{children:"Import A Source"})}),e.jsxs(k,{className:"flex flex-col md:flex-row gap-16",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{children:[e.jsx("span",{children:"Download sources from "}),e.jsxs(B,{children:[e.jsx(H,{className:"font-semibold underline cursor-default",children:"Manifest"}),e.jsx(I,{children:"Ports of official rules, and sources containing handy content, or particarly good homebrew."})]})]}),e.jsx(L,{className:"h-[35vh] md:h-[60vh]",children:e.jsx(ne,{})})]}),e.jsx("form",{id:"import-source",onSubmit:r=>{r.preventDefault(),o.handleSubmit()},className:"flex-1",children:e.jsx(J,{children:e.jsx(o.Field,{name:"file",validators:{onChange:de},children:r=>{const s=r.state.meta.isTouched&&!r.state.meta.isValid;return e.jsxs(q,{"data-invalid":s,children:[e.jsx(G,{children:"Upload JSON File"}),e.jsxs(Q,{value:r.state.value?[r.state.value]:[],onValueChange:n=>{r.handleChange(n[0])},accept:".json,application/json",maxFiles:1,onFileValidate:n=>n.name.endsWith(".json")?null:"Only JSON files are allowed",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ie,{className:"size-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Drop your JSON file here, or click to browse"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Only .json files are supported"})]})]})}),e.jsx(Z,{children:r.state.value&&e.jsxs(ee,{value:r.state.value,children:[e.jsx(se,{}),e.jsx(ae,{}),e.jsx(re,{asChild:!0,children:e.jsx(t,{type:"button",size:"icon",variant:"ghost",className:"size-8",children:e.jsx(M,{className:"size-4"})})})]})})]}),s&&e.jsx(R,{errors:r.state.meta.errors})]})}})})})]}),e.jsx(O,{className:"self-end",children:e.jsx(t,{type:"submit",form:"import-source",children:"Import Source"})})]})]})}export{fe as component};
